<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Starting the project &#8212; Slivka 0.1.dev1 documentation</title>
    
    <link rel="stylesheet" href="static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.dev1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running the app" href="running_project.html" />
    <link rel="prev" title="Requirements" href="installation.html" />
   
  <link rel="stylesheet" href="static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="starting-the-project">
<h1>Starting the project<a class="headerlink" href="#starting-the-project" title="Permalink to this headline">¶</a></h1>
<p>In order to create a new Slivka project navigate to the folder where you want
to set-up your project and use the executable created during the installation.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">slivka</span><span class="o">-</span><span class="n">setup</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Replacing <code class="docutils literal"><span class="pre">&lt;name&gt;</span></code> with the name of the project you create.
If the executable cannot be accessed (e.g. it is not in the PATH), you
can equivalently run the slivka module with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">slivka</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>It will create a new folder <code class="docutils literal"><span class="pre">&lt;name&gt;</span></code> and copy three core files to it and
sample service with its configuration. The three core files of the project are:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">manage.py:</th><td class="field-body">a main executable script which configures Slivka and runs its components.</td>
</tr>
<tr class="field-even field"><th class="field-name">settings.py:</th><td class="field-body">a settings Python module which contains project constants.</td>
</tr>
<tr class="field-odd field"><th class="field-name">service.ini:</th><td class="field-body">manages services execution and points to configuration files</td>
</tr>
</tbody>
</table>
<p>All three files are unicode text files and can be edited with any text editor.</p>
<div class="section" id="settings-file">
<h2>Settings file<a class="headerlink" href="#settings-file" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">settings.py</span></code> is a Python module file containing several constants which
are used over the entire application. Since it&#8217;s a python code which gets
imported and executed every time Slivka is started, you can place some
initialization scripts in here.
Several constants are inserted on project creation, but you are free to add
more, keeping that only uppercase variables are considered settings variables.
Here is the list of constants created on project set-up with description.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">BASE_DIR</span></code>:</th><td class="field-body"><p class="first">Must be set to the absolute location of the project folder. It tells the
script the path all other paths are relative to. It defaults to the
directory containing the settings file.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
</pre></div>
</div>
<p>You can set it to any path using <code class="docutils literal"><span class="pre">os.path.join</span></code> surrounded by
<code class="docutils literal"><span class="pre">os.path.abspath</span></code>. Relative paths should be avoided as they start at
current work directory which may be different for each execution.
It&#8217;s recommended to leave it unchanged.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;slivka&quot;</span><span class="p">))</span>
<span class="c1"># /var/slivka (Unix)</span>
<span class="c1"># C:\var\slivka (Windows)</span>

<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;/home/user/slivka/&quot;</span><span class="p">)</span>
<span class="c1"># /home/user/slivka (Unix)</span>
<span class="c1"># C:\home\user\slivka (Windows)</span>

<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">system32&quot;</span><span class="p">)</span>
<span class="c1"># C:\Windows\system32 (Windows)</span>
<span class="c1"># (some nasty output on Linux)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">SECRET_KEY</span></code>:</th><td class="field-body"><p class="first">A string of bytes used for signatures. Changing this key will invalidate all
identifier signatures. Please keep this key secret.</p>
<p>The key can be set to either bytes or unicode characters.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\x00\x01\x02\x03</span><span class="s1">&#39;</span>

<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s2">&quot;Lorem ipsum dolor sit amet&quot;</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">MEDIA_DIR</span></code>:</th><td class="field-body"><p class="first">Directory where all files uploaded by users and produced by services are
stored. It can be either an absolute path or path relative to the
<code class="docutils literal"><span class="pre">BASE_DIR</span></code>.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">WORK_DIR</span></code>:</th><td class="field-body"><p class="first">A folder where execution work directories will be created. Can be either
an absolute path or path relative to the <code class="docutils literal"><span class="pre">BASE_DIR</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">SERVICE_INI</span></code>:</th><td class="field-body"><p class="first">Path to <em>service.ini</em> file, absolute or relative to <code class="docutils literal"><span class="pre">BASE_DIR</span></code>.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">LOG_DIR</span></code>:</th><td class="field-body"><p class="first">Path to directory where log files will be stored. Can be either absolute
or relative to <code class="docutils literal"><span class="pre">BASE__DIR</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">QUEUE_HOST</span></code>:</th><td class="field-body"><p class="first">Address where the local queue is listening on. It&#8217;s highly recommended to use
localhost, as accepting connection from outside may be a security risk.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">QUEUE_PORT</span></code>:</th><td class="field-body"><p class="first">Port which local queue is listening to new connections on. It must not
collide with any commonly used ports and must be less than 65535.
It&#8217;s recommended to pick value between 1000 and 10000.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">SERVER_HOST</span></code>:</th><td class="field-body"><p class="first">Address at which the server accepts connections. You should use your
broadcast address or <code class="docutils literal"><span class="pre">&quot;0.0.0.0&quot;</span></code> to accept all connections.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">SERVER_PORT</span></code>:</th><td class="field-body"><p class="first">Port used for listening to REST requests. You might use one of the common
HTTP ports e.g. 8000, 8080 or 8888</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">DEBUG</span></code>:</th><td class="field-body"><p class="first last">Flag indicating whether debug mode should be enabled. Debug mode should not
be used in production.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="services-configuration">
<h2>Services configuration<a class="headerlink" href="#services-configuration" title="Permalink to this headline">¶</a></h2>
<p>An entry point to service configuration is put in the <em>service.ini</em> file.
The file consist of sections whose name is pun in square brackets <code class="docutils literal"><span class="pre">[section]</span></code>
and key-value pairs mapped to each other with equality sign (=) or colon (:)
e.g. <code class="docutils literal"><span class="pre">key</span> <span class="pre">=</span> <span class="pre">value</span></code>. More details about the structure of the file can be
found in the <a class="reference external" href="https://docs.python.org/3/library/configparser.html#supported-ini-file-structure">configparser</a> documentation.</p>
<p>The <code class="docutils literal"><span class="pre">[DEFAULT]</span></code> section is ignored by the application and can
be used to define constants i.e. project directory. These constants can be
referred using <code class="docutils literal"><span class="pre">%(key)s</span></code> placeholder similar to C-style formatting.
In the following example, the <code class="docutils literal"><span class="pre">address</span></code> field will be evaluated to
<code class="docutils literal"><span class="pre">example.com:80</span></code></p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">example.com</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">80</span>
<span class="na">address</span> <span class="o">=</span> <span class="s">%(host)s:%(port)s</span>
</pre></div>
</div>
<p>Each section (except <code class="docutils literal"><span class="pre">[DEFAULT]</span></code>) corresponds to one service configuration.
Services can be anything ranging from a different ways to call an application
to range of different applications. The section must contain two keys:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">config</span></code>:</th><td class="field-body">The path to the command definition file which structure is described in the
<a class="reference internal" href="#command-description">Command description</a> section.</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">form</span></code>:</th><td class="field-body">The path to user form definition file described in the <a class="reference internal" href="#form-description">Form description</a>
section.</td>
</tr>
</tbody>
</table>
<p>A sample configuration section of a service <em>Lorem</em> may look like this:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="na">root_path</span> <span class="o">=</span> <span class="s">/home/myself/slivka-project</span>

<span class="k">[Lorem]</span>
<span class="na">config</span> <span class="o">=</span> <span class="s">%(root_path)s/config/LoremConfig.yml</span>
<span class="na">form</span> <span class="o">=</span> <span class="s">%(root_path)/config/LoremForm.yml</span>
</pre></div>
</div>
</div>
<div class="section" id="form-description">
<h2>Form description<a class="headerlink" href="#form-description" title="Permalink to this headline">¶</a></h2>
<p>Form description file specified what fields are presented to the front end user
and what field values are expected. The file should contain a single JSON
object which keys are unique form field names and values are options and
restrictions imposed on the form field values.
Each field, regardless of its type, have three option fields:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">label</span></code>:</dt>
<dd>Human readable name of the field (required)</dd>
<dt><code class="docutils literal"><span class="pre">description</span></code>:</dt>
<dd>Detailed description of the fields or help text (optional)</dd>
<dt><code class="docutils literal"><span class="pre">value</span></code>:</dt>
<dd><a class="reference internal" href="#value-object">Value object</a> describing accepted field values (required)</dd>
</dl>
<p>Example of the form accepting two fields, file and file format is shown below.</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;input&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Input file&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Json or Yaml file containing data to be parsed&quot;</span><span class="p">,</span>
    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
      <span class="nt">&quot;maxSize&quot;</span><span class="p">:</span> <span class="s2">&quot;2KB&quot;</span><span class="p">,</span>
      <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;format&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;File format&quot;</span><span class="p">,</span>
    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;choice&quot;</span><span class="p">,</span>
      <span class="nt">&quot;choices&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;JSON&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="nt">&quot;YAML&quot;</span><span class="p">:</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span>
        <span class="nt">&quot;other&quot;</span><span class="p">:</span> <span class="s2">&quot;other&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="value-object">
<h3>Value object<a class="headerlink" href="#value-object" title="Permalink to this headline">¶</a></h3>
<p>Each value object, regardless of its type, may have three properties: <code class="docutils literal"><span class="pre">type</span></code>,
<code class="docutils literal"><span class="pre">required</span></code>, <code class="docutils literal"><span class="pre">default</span></code>. First, <code class="docutils literal"><span class="pre">type</span></code>, is required and can take one of the
following values: <code class="docutils literal"><span class="pre">int</span></code>, <code class="docutils literal"><span class="pre">float</span></code>, <code class="docutils literal"><span class="pre">text</span></code>, <code class="docutils literal"><span class="pre">boolean</span></code>, <code class="docutils literal"><span class="pre">choice</span></code> or
<code class="docutils literal"><span class="pre">file</span></code>.
Second, <code class="docutils literal"><span class="pre">required</span></code>, is required and specifies whether the value must be
specified for the form to be valid.
Third, <code class="docutils literal"><span class="pre">default</span></code>, is optional and its value should match type of the field.
It&#8217;s the default value of the field if user won&#8217;t choose anything.
Note that specifying default value makes the field not required as default
value is used if the field is left ampty.</p>
<p>All other properties are optional and they are specific for different types.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">int:</th><td class="field-body"><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">min</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(int)</span><dd><p class="first last">Inclusive minimum value, unbound if not present</p>
</dd>
<dt><code class="docutils literal"><span class="pre">max</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(int)</span><dd><p class="first last">Inclusive maximum value, unbound if not present</p>
</dd>
</dl>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
  <span class="nt">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;max&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">float:</th><td class="field-body"><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">min</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(float)</span><dd><p class="first last">Minimum value, unbound if not present</p>
</dd>
<dt><code class="docutils literal"><span class="pre">max</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(float)</span><dd><p class="first last">Maximum value, unbound if not present</p>
</dd>
<dt><code class="docutils literal"><span class="pre">minExclusive</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(boolean)</span><dd><p class="first last">Is minimum exclusive?</p>
</dd>
<dt><code class="docutils literal"><span class="pre">maxExclusive</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(boolean)</span><dd><p class="first last">Is maximum exclusive?</p>
</dd>
</dl>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
  <span class="nt">&quot;min&quot;</span><span class="p">:</span> <span class="mf">-4.0</span><span class="p">,</span>
  <span class="nt">&quot;minExclusive&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;max&quot;</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">,</span>
  <span class="nt">&quot;maxExlusive&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">text:</th><td class="field-body"><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">minLength</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(int)</span><dd><p class="first last">Minimum length of the text, minimum 0.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">maxLength</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(int)</span><dd><p class="first last">Maximum length of the text, minimum 0.</p>
</dd>
</dl>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
  <span class="nt">&quot;minLength&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;maxLength&quot;</span><span class="p">:</span> <span class="mi">8</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">boolean:</th><td class="field-body"><p class="first">Boolean field evaluates to true for each input value except <code class="docutils literal"><span class="pre">&quot;false&quot;</span></code>,
<code class="docutils literal"><span class="pre">&quot;0&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;null&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;no&quot;</span></code>; otherwise, it becomes <code class="docutils literal"><span class="pre">None</span></code></p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span><span class="p">,</span>
  <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">choice:</th><td class="field-body"><p class="first">In choice field only one of the available choices can be selected.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">choices</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(object)</span><dd><p class="first last">Choices are defined as an object where property key is option name and the
value is choice value. When the choice name is selected, it&#8217;s value is
passed to the parameter.</p>
</dd>
</dl>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;choice&quot;</span><span class="p">,</span>
  <span class="nt">&quot;choices&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;Alpha&quot;</span><span class="p">:</span> <span class="s2">&quot;--alpha&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Beta&quot;</span><span class="p">:</span> <span class="s2">&quot;--beta&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Gamma&quot;</span><span class="p">:</span> <span class="s2">&quot;--gamma&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;--alpha&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">file:</th><td class="field-body"><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">mimetype</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(string)</span><dd><p class="first last">Accepted mime type of the file.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">extension</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(string)</span><dd><p class="first last">Accepted file extensions (without leading dot)</p>
</dd>
<dt><code class="docutils literal"><span class="pre">maxSize</span></code></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(string)</span><dd><p class="first last">Maximum file size represented as a number and units e.g. <code class="docutils literal"><span class="pre">5B</span></code>, <code class="docutils literal"><span class="pre">2GB</span></code>.
Number must be an integer and allowed units are: B, KB, MB, GB or TB.</p>
</dd>
</dl>
<div class="last highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
  <span class="nt">&quot;mimetype&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
  <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;md&quot;</span><span class="p">,</span>
  <span class="nt">&quot;maxSize&quot;</span><span class="p">:</span> <span class="s2">&quot;10KB&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="command-description">
<h2>Command description<a class="headerlink" href="#command-description" title="Permalink to this headline">¶</a></h2>
<p>Command description files tell the application how to communicate with the
script and how to submit it to the queue.
The file should be written using either YAML or JSON syntax and should
follow structure described below.</p>
<p>The root object must have the following properties: <code class="docutils literal"><span class="pre">options</span></code> which is the
list of <a class="reference internal" href="#option-objects">Option objects</a>, <code class="docutils literal"><span class="pre">result</span></code> which is the list
of <a class="reference internal" href="#result-objects">Result objects</a>, <code class="docutils literal"><span class="pre">configurations</span></code> which is the
map of configuration names and parameters described in <a class="reference internal" href="#configurations">Configurations</a> and
<code class="docutils literal"><span class="pre">limits</span></code> which specifies the importable Python class providing configuration
selection.</p>
<div class="section" id="option-objects">
<h3>Option objects<a class="headerlink" href="#option-objects" title="Permalink to this headline">¶</a></h3>
<p>Each option object must have properties <code class="docutils literal"><span class="pre">ref</span></code> and <code class="docutils literal"><span class="pre">param</span></code>.
Optionally you may add <code class="docutils literal"><span class="pre">val</span></code> if you want to use a default value.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">ref</span></code>:</th><td class="field-body">Corresponding field name in the form definition file. The value of the form
field with this name will be used for this option.</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">param</span></code>:</th><td class="field-body">Template of the command option. Field value will be replaced for <code class="docutils literal"><span class="pre">${value}</span></code>
placeholder. i.e. <code class="docutils literal"><span class="pre">--in</span> <span class="pre">${value}</span></code>, <code class="docutils literal"><span class="pre">-a=${value}</span></code>.
<code class="docutils literal"><span class="pre">${value}</span></code> is not required and, if not given, the option will be
passed independently of the field value.</td>
</tr>
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">val</span></code>:</th><td class="field-body">Value used if corresponding field in the form is not found or evaluates to
<code class="docutils literal"><span class="pre">None</span></code>. Useful when you need to specify constants i.e. output file flag.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span>
      <span class="nt">&quot;param&quot;</span><span class="p">:</span> <span class="s2">&quot;-m $value&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span>
      <span class="nt">&quot;param&quot;</span><span class="p">:</span> <span class="s2">&quot;--format=$value&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span>
      <span class="nt">&quot;param&quot;</span><span class="p">:</span> <span class="s2">&quot;-o $value&quot;</span><span class="p">,</span>
      <span class="nt">&quot;val&quot;</span><span class="p">:</span> <span class="s2">&quot;output_file.o&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="result-objects">
<h3>Result objects<a class="headerlink" href="#result-objects" title="Permalink to this headline">¶</a></h3>
<p>Result objects describe possible outputs of the command execution.
Each output object should have <code class="docutils literal"><span class="pre">type</span></code> property which takes one of the values:
<code class="docutils literal"><span class="pre">result</span></code>, <code class="docutils literal"><span class="pre">error</span></code> or <code class="docutils literal"><span class="pre">log</span></code> which indicates whether the output should be
interpreted as computation result, error message or log file, respectively.
<code class="docutils literal"><span class="pre">method</span></code> property defines how the output can be retrieved.
The only allowed value is <code class="docutils literal"><span class="pre">file</span></code> which indicates that the content is stored
in the file.
If the output method is set to <code class="docutils literal"><span class="pre">file</span></code>, exactly one of the
following properties must be provided</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">path</span></code>:</th><td class="field-body">A path to the output file relative to the current working directory.</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">pattern</span></code>:</th><td class="field-body">Regular expression used to match output files.
May be used to specify the folder with output files or data split between
multiple files.</td>
</tr>
</tbody>
</table>
<p>Note, <code class="docutils literal"><span class="pre">path</span></code> should be used if the service is exprected to produce the file.
If command returns and this file is not present, job is considered failed.
<code class="docutils literal"><span class="pre">pattern</span></code> should be used for multiple files and optional files when zero or
more files are expected. These paths are evaluated lazily after the job is
finished and match as many files as is present at the job completion.</p>
<p>Example of the list of outputs:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span>
      <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
      <span class="nt">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;/build/.+\\.o&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span>
      <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
      <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;file.out&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
      <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
      <span class="nt">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;error\\.log&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
      <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
      <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;output.log&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="configurations">
<h3>Configurations<a class="headerlink" href="#configurations" title="Permalink to this headline">¶</a></h3>
<p>Each configuration describes how the command will be dispatched to the queue.
It can be either local queue or Sun Grid Engine accessible on the machine.
Each key in the <code class="docutils literal"><span class="pre">configuration</span></code> object represents configuration name which
can be referenced in the limits module.</p>
<p>Values should be objects with following properties:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">execClass</span></code>:</th><td class="field-body">Class of the executor used to start the job with given configuration.
Available values are <code class="docutils literal"><span class="pre">LocalExec</span></code> for local queue manager provided with
Slivka, <code class="docutils literal"><span class="pre">ShellExec</span></code> which simply spawns a new process (only recommended
for very short jobs which takes milliseconds to complete) and
<code class="docutils literal"><span class="pre">GridEngineExec</span></code> which sends the job to Sun Grid Engine.</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">bin</span></code>:</th><td class="field-body">Command or path to executable binary which will be executed with the queue.
Command is passed as it is to the shell, so keep correct escaping and
quotation.</td>
</tr>
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">queueArgs</span></code>:</th><td class="field-body">List of arguments passed directly to the queue command. It&#8217;s optional and
is applicable to several execution environments only.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;configurations&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;local&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;execClass&quot;</span><span class="p">:</span> <span class="s2">&quot;LocalExec&quot;</span><span class="p">,</span>
      <span class="nt">&quot;bin&quot;</span><span class="p">:</span> <span class="s2">&quot;python \&quot;/var/slivka-project/binaries/pydummy.py\&quot;&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;execClass&quot;</span><span class="p">:</span> <span class="s2">&quot;GridEngineExec&quot;</span><span class="p">,</span>
      <span class="nt">&quot;bin&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/slivka-project/binaries/pydummy.py&quot;</span><span class="p">,</span>
      <span class="nt">&quot;queueArgs&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PATH=/local/python-envs/slivka/bin&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="limits">
<h3>Limits<a class="headerlink" href="#limits" title="Permalink to this headline">¶</a></h3>
<p>Path to the Python class which performs selection of the configuration based on
command parameters. It has to be a valid Python import path (packages separated
with dots) accessible to the application. Folder containing Python module and
its parent folders must contain an empty <em>__init__.py</em> file to be Python
packages.
More details on limits classes is in the <a class="reference internal" href="#limits-class">Limits class</a> section.</p>
</div>
</div>
<div class="section" id="limits-class">
<h2>Limits class<a class="headerlink" href="#limits-class" title="Permalink to this headline">¶</a></h2>
<p>In your project configuration you may create one of more Python modules
containing limit classes. Each class should contain methods which allows to
pick one configuration when given values passed to the form.</p>
<p>Limits class must extend <code class="docutils literal"><span class="pre">slivka.scheduler.executors.JobLimits</span></code> class
and define one class attribute <code class="docutils literal"><span class="pre">configurations</span></code> containing the list of
configuration names in order of evaluation.
For each configuration you should specify a method named
<code class="docutils literal"><span class="pre">limit_&lt;configuration&gt;</span></code> which accepts one argument - dictionary containing
form values. Each of the methods should return <code class="docutils literal"><span class="pre">True</span></code> or <code class="docutils literal"><span class="pre">False</span></code> depending
on whether for given form values this configuration should be selected.
Limits are evaluated in the order specified in the <code class="docutils literal"><span class="pre">configurations</span></code> list
and first one which returns <code class="docutils literal"><span class="pre">True</span></code> is picked.
You may also need to define <code class="docutils literal"><span class="pre">setup</span></code> method for expensive operations.
<code class="docutils literal"><span class="pre">setup</span></code> is called before all limit methods and can be used to prepare some
variables beforehand and store them as attributes of <code class="docutils literal"><span class="pre">self</span></code>.</p>
<p>Let&#8217;s look at the example of dummy json/yaml reader.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">slivka.scheduler.executors</span> <span class="kn">import</span> <span class="n">JobLimits</span>

<span class="k">class</span> <span class="nc">MyLimits</span><span class="p">(</span><span class="n">JobLimits</span><span class="p">):</span>

    <span class="n">configurations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first_conf&#39;</span><span class="p">,</span> <span class="s1">&#39;second_conf&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span>
        <span class="n">statinfo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_file_size</span> <span class="o">=</span> <span class="n">statinfo</span><span class="o">.</span><span class="n">st_size</span>

    <span class="k">def</span> <span class="nf">limit_first_conf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_file_size</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yaml&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_file_size</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">limit_second_conf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_file_size</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<p>First, inside <code class="docutils literal"><span class="pre">setup</span></code> method, it retrieves input file path, checks its size
in bytes and stores the value in the <code class="docutils literal"><span class="pre">input_file_size</span></code> property.
Next, it checks criteria for first configuration which are: less than 100B
json file or less than 20B yaml file. If they are not met, refuse to use this
configuration and jump to the next in the list.
Second configuration, on the other hand, is executed if the file size does not
exceed 1000B. Otherwise, scheduler will refuse to start the job.</p>
<p>Field values can be obtained from the method argument using field name as a
dictionary key. All values are strings in the format as they are entered in the
shell command and may require conversion to other types.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Starting the project</a><ul>
<li><a class="reference internal" href="#settings-file">Settings file</a></li>
<li><a class="reference internal" href="#services-configuration">Services configuration</a></li>
<li><a class="reference internal" href="#form-description">Form description</a><ul>
<li><a class="reference internal" href="#value-object">Value object</a></li>
</ul>
</li>
<li><a class="reference internal" href="#command-description">Command description</a><ul>
<li><a class="reference internal" href="#option-objects">Option objects</a></li>
<li><a class="reference internal" href="#result-objects">Result objects</a></li>
<li><a class="reference internal" href="#configurations">Configurations</a></li>
<li><a class="reference internal" href="#limits">Limits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#limits-class">Limits class</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Requirements</a></li>
      <li>Next: <a href="running_project.html" title="next chapter">Running the app</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="sources/configuration.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Mateusz Maciej Warowny.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="sources/configuration.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>