
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Getting Started &#8212; slivka 0.8.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration" href="specification.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="specification.html" title="Configuration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">slivka 0.8.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Getting Started</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading">¶</a></h1>
<p>This page will provide you with a basic introduction to slivka.
You will learn how to create and run a slivka project, configure
web services and access them from the web using curl.
First, follow the <a class="reference internal" href="installation.html"><span class="doc">Installation</span></a> instructions to install slivka
and proceed to the following sections in this document.</p>
<section id="a-minimal-application">
<h2>A Minimal Application<a class="headerlink" href="#a-minimal-application" title="Permalink to this heading">¶</a></h2>
<p>Slivka does not provide any web services out of the box, it is a
framework that allows you to turn command-line tools into services.
Before you can start hosting the web services, you must create a new
slivka project. The project is a collection of configuration files
containing slivka settings and service definitions, and, optionally,
scripts and binary files. In order to set up a new project, navigate
to a directory where you want to create a new project and run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slivka</span> <span class="n">init</span> <span class="n">my</span><span class="o">-</span><span class="n">slivka</span><span class="o">-</span><span class="n">project</span>
</pre></div>
</div>
<p>This command will create a new directory named
<code class="file docutils literal notranslate"><span class="pre">my-slivka-project</span></code> and copy the essential project files into
it. You may change the name of the project directory or use <code class="docutils literal notranslate"><span class="pre">.</span></code> to
install the files directly in the current directory.</p>
<p>In this documentation, we refer to the topmost project directory
(<code class="file docutils literal notranslate"><span class="pre">my-slivka-project</span></code> in this example) as a project root or
project home directory. This is the directory containing the
<code class="file docutils literal notranslate"><span class="pre">config.yaml</span></code> file and it is typically a working directory of a
<em>slivka</em> process. All relative paths are resolved relative to this
directory.</p>
<p>To run the application, navigate into the project root directory and
start three slivka processes in the background: server, scheduler and
local-queue (make sure that the MongoDB is already running).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slivka</span> <span class="n">start</span> <span class="n">server</span> <span class="o">&amp;</span>
<span class="n">slivka</span> <span class="n">start</span> <span class="n">scheduler</span> <span class="o">&amp;</span>
<span class="n">slivka</span> <span class="n">start</span> <span class="n">local</span><span class="o">-</span><span class="n">queue</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>Once they are running, slivka is ready to accept and process incoming
job requests. You can see that the server is up by visiting
<a class="reference external" href="http://127.0.0.1:4040/api/version">http://127.0.0.1:4040/api/version</a>. The page should display the
current version of the slivka framework and API. You can stop the
processes by sending an INTERRUPT signal or pressing <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Control</kbd>-<kbd class="kbd docutils literal notranslate">C</kbd></kbd>
when the process is in the foreground.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your MongoDB is listening on a port other than the default
or any of the ports used by slivka are already in use you can
change them in the <em>config.yaml</em> file.</p>
</div>
</section>
<section id="structure-of-slivka">
<h2>Structure of Slivka<a class="headerlink" href="#structure-of-slivka" title="Permalink to this heading">¶</a></h2>
<p>Before we dive into the details of writing web services, we should
briefly understand how slivka is organised with the help of a diagram.</p>
<figure class="align-default">
<img alt="_images/overview.svg" src="_images/overview.svg" /></figure>
<p>At the front of the application, there is a REST server that provides
an interface to communicate with slivka from the web. Clients can talk
to the server over HTTP to send new jobs, query running jobs status or
request output files. The server stashes all job requests in the
database to be picked up by the scheduler.</p>
<p>The scheduler is the heart of the application. It is responsible for
processing job requests, combining parameters into command-line
arguments and dispatching jobs to execution systems. It collects job
requests from the Mongo Database and dispatches them to the available
execution systems. It continuously monitors the jobs and updates their
status in the database.</p>
<p>The scheduler maintains one or more runners for each installed
service. The runners are interfaces between the scheduler and
workload managers or an operating system. They contain instructions on
how to execute command line programs provided by the scheduler
and monitor their status.</p>
<p>If you do not use advanced workload managers on your system, slivka
comes with a simple worker queue process which spawns job processes
locally.</p>
<section id="configuration-files">
<h3>Configuration files<a class="headerlink" href="#configuration-files" title="Permalink to this heading">¶</a></h3>
<p>The configuration files live outside the slivka library inside the
project directory. They supply variables to slivka which are located
in the <code class="file docutils literal notranslate"><span class="pre">config.yaml</span></code> file and provide web service definitions
specified in the <code class="file docutils literal notranslate"><em><span class="pre">service_name</span></em><span class="pre">.service.yaml</span></code> files inside the
<code class="file docutils literal notranslate"><span class="pre">services</span></code> directory. Additionally, you may include custom
scripts, binaries and static files inside the project to be used by
that slivka instance. This way you can have multiple projects set up
on a single machine each having individual configurations and
services.</p>
<p>As a system administrator, you are responsible for writing and
maintaining those configuration files. Therefore, the rest of this
tutorial focuses on the configuration files.</p>
</section>
<section id="directory-structure">
<h3>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this heading">¶</a></h3>
<p>New slivka projects created by <strong class="program">slivka init</strong> are initialized
with the following directory structure:</p>
<div class="line-block">
<div class="line">&lt;project-root&gt;/</div>
<div class="line">├── config.yaml</div>
<div class="line">├── manage.py</div>
<div class="line">├── scripts/</div>
<div class="line">│   ├── example.py</div>
<div class="line">│   └── selectors.py</div>
<div class="line">├── services/</div>
<div class="line">│   └── example.service.yaml</div>
<div class="line">├── static/</div>
<div class="line">│   ├── openapi.yaml</div>
<div class="line">│   └── redoc-index.html</div>
<div class="line">└── wsgi.py</div>
</div>
<p>The starting point of the configuration is the <code class="file docutils literal notranslate"><span class="pre">config.yaml</span></code>
file. It provides important parameters needed to start slivka and
is the first file slivka searches for on startup.
The variables contained in the file allow you to control the
structure of directories used by slivka, server addresses and
database connection.
The structure of the configuration file is explained in detail
in the <a class="reference internal" href="specification.html#specification-config-file"><span class="std std-ref">Configuration file</span></a> section on the
<a class="reference internal" href="specification.html"><span class="doc">Configuration</span></a> page.</p>
<p>New projects come with an example service which can be used as a base
for creating other services. The command line program this service
runs is an <code class="file docutils literal notranslate"><span class="pre">example.py</span></code> Python script located in the
<code class="file docutils literal notranslate"><span class="pre">scripts</span></code> directory. The service configuration is located in the
<code class="file docutils literal notranslate"><span class="pre">services/example.service.yaml</span></code> file. Slivka searches for
service definitions in files under the <code class="file docutils literal notranslate"><span class="pre">services</span></code> directory
whose name match <code class="file docutils literal notranslate"><em><span class="pre">service_id</span></em><span class="pre">.service.yaml</span></code> pattern. That
directory may be changed in the main configuration file. For each
service file found, slivka instantiates a single web service. There is
no upper limit to the number of services hosted by a single slivka
instance as long as their identifiers are unique.</p>
<p>The service definitions may be accompanied by a selector script. The
example service uses a function from the <code class="file docutils literal notranslate"><span class="pre">scripts/selectors.py</span></code>
module. Selectors are functions that control the job execution method
based on the input parameters. They are covered in the
<a class="reference internal" href="advanced_usage.html#advanced-usage-selectors"><span class="std std-ref">Selectors</span></a> topic in the advanced usage topic.</p>
<p>The <code class="file docutils literal notranslate"><span class="pre">wsgi.py</span></code> module contains a WSGI-compatible application as
specified by <a class="reference external" href="https://www.python.org/dev/peps/pep-3333/">PEP-3333</a> providing web access to the services. The
module is loaded by a WSGI middleware when the server process is
started. You may instruct your WSGI server to load this module
directly instead of starting the server through the <strong class="program">slivka</strong>
command.</p>
<p>The <code class="file docutils literal notranslate"><span class="pre">manage.py</span></code> is an executable script which used to be the
primary way to launch slivka. Its functionality was fully replaced by
the <strong class="program">slivka</strong> command.</p>
<p>The <code class="file docutils literal notranslate"><span class="pre">static</span></code> directory contains static files used by the HTTP
server to render API documentation. The <a class="reference external" href="https://swagger.io/specification/">OpenAPI 3.0.3</a>
specification is loaded from the <code class="file docutils literal notranslate"><span class="pre">openapi.yaml</span></code> file and
rendered by the <a class="reference external" href="https://github.com/Redocly/redoc">Redoc</a> documentation generator in the
<code class="file docutils literal notranslate"><span class="pre">redoc-index.html</span></code>. You can view the generated documentation by
visiting the <a class="reference external" href="http://127.0.0.1:4040/api/">/api/</a> endpoint on your server. You may edit those
files according to your needs or delete them altogether. If deleted,
the server will use the default files from the slivka package
resources. This feature is experimental and is subject to change in
future versions.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.0b20: </span>API documentation files</p>
</div>
</section>
</section>
<section id="example-service">
<span id="getting-started-example-service"></span><h2>Example Service<a class="headerlink" href="#example-service" title="Permalink to this heading">¶</a></h2>
<p>Services are added to slivka by creating a
<code class="file docutils literal notranslate"><em><span class="pre">service_id</span></em><span class="pre">.service.yaml</span></code> file inside of the <code class="file docutils literal notranslate"><span class="pre">services</span></code>
directory, where <em>service_id</em> is a unique identifier of the service.
When you created the new project it came with an example service
demonstrating how the service files are structured and providing a
template for adding more services.</p>
<p>The example service runs the <code class="file docutils literal notranslate"><span class="pre">scripts/example.py</span></code> command line
program located in the project directory. In fact, slivka can run
any program installed on your computer which doesn’t have to be
located under the project directory.</p>
<p>The example script is executed with a Python interpreter and
demonstrates the usage of different kinds of command-line arguments.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python example.py <span class="o">[</span>--infile FILE<span class="o">]</span> <span class="o">[</span>--opt TEXT<span class="o">]</span> <span class="o">[</span>--rep REP<span class="o">[</span>,REP,...<span class="o">]]</span> <span class="se">\</span>
  <span class="o">[</span>--delay SECONDS<span class="o">]</span> <span class="o">[</span>--letter LETTER<span class="o">]</span> <span class="o">[</span>--flag<span class="o">]</span> -- ARG
</pre></div>
</div>
<p>The script takes, in that order, an optional input file parameter, a
text parameter, a parameter that takes multiple comma-separated
values, a number, a value from the list of available choices, a
boolean flag and a positional argument.</p>
<p>The <code class="file docutils literal notranslate"><span class="pre">services/example.service.yaml</span></code> contains instructions on how
to turn this command line program into a web service. We will now go
through the file explaining each parameter.
The configuration files use <a class="reference external" href="https://yaml.org/">YAML</a> syntax. Make sure you are
familiar with that data format before continuing.</p>
<section id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Permalink to this heading">¶</a></h3>
<p>The first few lines of the file are a good spot to place a few comments
describing the service and adding guidelines for anyone maintaining
it. All lines starting with <code class="docutils literal notranslate"><span class="pre">#</span></code> are ignored by the program and
serve as comments. The example already contains a few of them in
several places.</p>
<p>The uppermost set of properties makes service metadata. They serve an
informational purpose for the service users. The properties include
<em>slivka-version</em> for detecting compatibility between service and
library versions followed by a <em>name</em> and a <em>description</em> storing a
display name and a description of the service. Optionally, you may
include a tool’s <em>author</em>, software <em>version</em>, <em>license</em> and a list of
<em>classifiers</em> helping users and client software categorise and
recognise the service.</p>
</section>
<section id="input-parameters">
<h3>Input Parameters<a class="headerlink" href="#input-parameters" title="Permalink to this heading">¶</a></h3>
<p>The following property, named <em>parameters</em>, typically makes the most
of the configuration file. It lists all input parameters of the
service which will be later mapped to the command line arguments.</p>
<p>Each key of the <em>parameters</em> mapping is a unique parameter id. It
can only contain letters, digits, dashes and underscores. The ids are
mainly used by applications to identify the parameters.
The object under each key describes the parameter. It contains
relevant information about the parameter such as its name, description,
type and value constraints.</p>
<p>Each parameter must include two required properties: <em>name</em> and
<em>type</em>. The <em>name</em> is the name of the service displayed to the users.
It may differ from the identifier and doesn’t impose any character
restrictions. Keep it concise and self-explanatory about what the
parameter is controlling. If you need to disclose more information,
you can include it in an optional <em>description</em> property. The <em>type</em>
property defines the type of the input parameter. There are several
built-in types which should cover the majority of use cases. Those
are <code class="docutils literal notranslate"><span class="pre">integer</span></code>, <code class="docutils literal notranslate"><span class="pre">decimal</span></code>, <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">flag</span></code>, <code class="docutils literal notranslate"><span class="pre">choice</span></code> and
<code class="docutils literal notranslate"><span class="pre">file</span></code>. Additionally, the type name can be followed by a pair of
square brackets in order to change it to an array type accepting
multiple values e.g. <code class="docutils literal notranslate"><span class="pre">text[]</span></code>.</p>
<p>You may specify a default value for a parameter by setting a <em>default</em>
property. The default value will be used if the parameter is not
supplied by the user explicitly. Specifying the default value is
optional.</p>
<p>By default, every input parameter is required and slivka will report
an error if a value for a required parameter is not provided.
This behaviour may be changed by setting a <em>required</em> property to
<code class="docutils literal notranslate"><span class="pre">false</span></code> (default is <code class="docutils literal notranslate"><span class="pre">true</span></code>). Note that using the default value
nullifies parameter requirement automatically making it optional.</p>
<p>Depending on the parameter type, there are additional properties that
can be used to impose additional constraints on the value. Numeric
types allow specifying <em>min</em> and <em>max</em> values of the parameter; text
type adds <em>min-length</em> and <em>max-length</em> constraints; choice adds
allowed <em>choices</em>. An exhaustive list of parameter types and allowed
constraints is specified in the <a class="reference internal" href="specification.html#parameters-specification"><span class="std std-ref">Input parameters</span></a>
section on the <a class="reference internal" href="specification.html"><span class="doc">Configuration</span></a> page.</p>
</section>
<section id="command">
<h3>Command<a class="headerlink" href="#command" title="Permalink to this heading">¶</a></h3>
<p>The <em>command</em> property is a required property that contains the base
command that will be used to start the command line program.
The arguments can be supplied as an array (similar to those you pass
to the <code class="docutils literal notranslate"><span class="pre">execl</span></code> function) or as a string, in which case slivka will
split the string into individual arguments. The former method is
preferred if your command contains special characters and you want
to make sure it’s interpreted unambiguously.</p>
<p>You are allowed to include environment variables in the command using
either a <code class="docutils literal notranslate"><span class="pre">$VARIABLE</span></code> or <code class="docutils literal notranslate"><span class="pre">${VARIABLE}</span></code> syntax. A literal “$”
character can be obtained by escaping it with another dollar character
such as <code class="docutils literal notranslate"><span class="pre">$$</span></code>. Both current system environment variables and the
variables defined for that service (more on customising environment
variables later) will be used to interpolate the variables in the
command. Additionally, slivka adds a special <code class="docutils literal notranslate"><span class="pre">$SLIVKA_HOME</span></code> variable
that contains the absolute path to the project root directory (without
a trailing slash) which can be used to construct paths that are under
the project root directory.</p>
<p>The example service runs the <code class="file docutils literal notranslate"><span class="pre">scripts/example.py</span></code> file from the
project root directory using a default <strong class="command">python</strong> interpreter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the program or script is not directly available from the <em>PATH</em>
you <strong>must</strong> provide an absolute path to it. Failing to do so will
result in failing jobs with a “file not found” error.</p>
</div>
</section>
<section id="program-arguments">
<h3>Program Arguments<a class="headerlink" href="#program-arguments" title="Permalink to this heading">¶</a></h3>
<p>Once we specified the base command and the input parameters, we must
instruct slivka how to translate those inputs to the command line
arguments. The <em>args</em> parameter defines the rules of translating the
input parameters to the command line arguments. For each key specified
in the <em>parameters</em>, you need to add an entry in the <em>args</em> mapping
having the same key. Each entry value is an object defining at least
an <em>arg</em> property that contains a template for the command line
argument. A <code class="docutils literal notranslate"><span class="pre">$(value)</span></code> placeholder in the template will be replaced
by the input value provided by the user. The arguments are inserted
into the command line in their definition order. When the value of the
parameter is missing, the entire argument is skipped. You should not
worry about special characters, quotes or spaces in the user’s input.
Slivka automatically converts all values to strings and quotes and
escapes them before inserting them into the command line. Arguments
may also contain environment variables which are processed the same
way as for the <a class="reference external" href="command">base command</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Never evaluate user input directly. Running commands such as <code class="docutils literal notranslate"><span class="pre">bash</span>
<span class="pre">-c</span></code> is a serious security issue.</p>
</div>
<p>Let’s take a look at the simplest case, the <em>opt</em> parameter in the
example service.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">opt</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">arg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--opt $(value)</span><span class="w"></span>
</pre></div>
</div>
<p>This instruction passes the value of the matching <em>opt</em> input
parameter to the command line program as the <code class="docutils literal notranslate"><span class="pre">--opt</span> <span class="pre">TEXT</span></code> argument.
The <em>arg</em> template is <code class="docutils literal notranslate"><span class="pre">--opt</span> <span class="pre">$(value)</span></code> and the actual value is
substituted for the <code class="docutils literal notranslate"><span class="pre">$(value)</span></code> placeholder. For example, if a user
provides a <em>“cosy bathroom”</em> string as an input to the <em>opt</em>
parameter, then the constructed command line arguments are <code class="docutils literal notranslate"><span class="pre">--opt</span>
<span class="pre">'cosy</span> <span class="pre">bathroom'</span></code>.</p>
<p>If the input parameter has multiple values, the argument is repeated
multiple times for each value. You can alter this behaviour by adding
a <em>join</em> property containing a character that will be used to join
multiple values into one argument. In the example the <code class="docutils literal notranslate"><span class="pre">--rep</span>
<span class="pre">REP[,REP,...]</span></code> parameter takes multiple comma-separated values,
therefore the <em>arg</em> becomes <code class="docutils literal notranslate"><span class="pre">--rep</span> <span class="pre">$(value)</span></code> and a comma character
is used for the <em>join</em>. The resulting arguments will be <code class="docutils literal notranslate"><span class="pre">--rep</span>
<span class="pre">valA,valB,valC</span></code>. If <em>join</em> were not provided, the argument would be
repeated for each value <code class="docutils literal notranslate"><span class="pre">--rep</span> <span class="pre">valA</span> <span class="pre">--rep</span> <span class="pre">valB</span> <span class="pre">--rep</span> <span class="pre">valC</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using space to join the values does not yield multiple arguments.
The joined string is always treated as a single argument i.e.
<code class="docutils literal notranslate"><span class="pre">--rep</span> <span class="pre">&quot;valA</span> <span class="pre">valB</span> <span class="pre">valC&quot;</span></code>.</p>
</div>
<p>The file-type parameters are converted to absolute paths prior to
being passed to the command line and, for all intents and purposes,
can be treated as any other string. Those paths typically point
outside the working directory of the process, which well-behaved
programs should handle with no issues. However, you can add a special
<em>symlink</em> argument with a link name, which tells slivka to create a
symbolic link to the original file in the process’ working directory
and to use its name instead. That’s particularly useful for programs that
require input files to be present in the current working directory or
have specific name requirements. If the symbolic link could not be
created, slivka tries to create a hard link and, if it fails too, it
copies the file to the target location.</p>
<p>A slightly different type of parameter is a flag. It typically
doesn’t have a value associated with it. Instead, it can be either in
a present or an absent state. Under the hood, flags do actually have a
value of <code class="docutils literal notranslate"><span class="pre">&quot;true&quot;</span></code> literal if enabled or nothing if disabled which
results in the parameter being skipped.</p>
<p>Although every input parameter must be reflected in the arguments, the
opposite is not true. You may add arguments which are not defined in
the list of parameters. We recommend naming those arguments starting
with an underscore to differentiate them from “regular” arguments.
Those arguments have no way to fetch their value from the input
parameters and therefore are always omitted unless a <em>default</em>
constant value is provided explicitly in the argument definition. They
can be used to supply constants to the command line which should not
be altered by users. In the example, we specified a <em>_separator</em>
argument which inserts <code class="docutils literal notranslate"><span class="pre">--</span></code> between options and positional
arguments. In order to not be skipped, we gave it a constant
placeholder value “present”. The <code class="docutils literal notranslate"><span class="pre">$(value)</span></code> placeholder can also
be used in those constant arguments and will be set to the default
value e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">_output-file</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">arg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--output=$(value)</span><span class="w"></span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result.out</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="environment-variables">
<h3>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this heading">¶</a></h3>
<p>If a program requires environment variables to work properly, you can
define them inside an <em>env</em> property. The <em>env</em> property is optional
and, if it exists, it should contain a mapping of environment variable
names to their values. Those variables will be set for every process
started for that service. You can reference system environment
variables in the variable values using the <code class="docutils literal notranslate"><span class="pre">${VARIABLE}</span></code> syntax.
However, you can’t include other variables from this mapping to avoid
circular dependencies and ambiguity.</p>
<p>In the example, we stored a <code class="docutils literal notranslate"><span class="pre">/usr/bin/env</span> <span class="pre">python</span></code> command in the
<code class="docutils literal notranslate"><span class="pre">PYTHON</span></code> variable which could be re-used in the command as
<code class="docutils literal notranslate"><span class="pre">$PYTHON</span></code>. We also redefined the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> variable prepending the
path to a <code class="file docutils literal notranslate"><span class="pre">bin</span></code> directory from the project’s root directory to
it.</p>
<p>Every process is executed in a modified environment with all system
variables except for <code class="docutils literal notranslate"><span class="pre">PATH</span></code> removed and all variables from the <em>env</em>
property then added. If you need a system variable to propagate to the
program, you need to set its value to itself in the <em>env</em> e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">env</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">MY_VARIABLE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MY_VARIABLE}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="output-files">
<h3>Output files<a class="headerlink" href="#output-files" title="Permalink to this heading">¶</a></h3>
<p>The last stage after running the program is collecting its output.
Slivka covers the output written to files and to the standard output
and error streams. The <em>outputs</em> property enumerates all output files
that should be presented to the front-end users. Each key in the
mapping represents a single output file or a group of files. The only
required property of the result object is a <em>path</em> containing a path
relative to the working directory of the process or a <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)">glob</a> pattern
that will be used to match output files. The standard output and error
streams are automatically redirected to <code class="file docutils literal notranslate"><span class="pre">stdout</span></code> and
<code class="file docutils literal notranslate"><span class="pre">stderr</span></code> files respectively and can be referred to by those
names.</p>
<p>You can include additional metadata to aid users such as a
human-readable name under the <em>name</em> property or a <em>media-type</em>
(as discussed in <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc2045">RFC 2045</a>) to help client software recognise the
file types.</p>
</section>
<section id="execution-management">
<h3>Execution Management<a class="headerlink" href="#execution-management" title="Permalink to this heading">¶</a></h3>
<p>The last bit of the service configuration is not strictly about the
command line program, but the way it is launched on a computer. Once the
command line arguments and environment variables are sorted out, the
scheduler sends it to one of the <code class="docutils literal notranslate"><span class="pre">Runner</span></code> implementations. The
runner takes a list of arguments and spawns a new process on the
system. Runners available for the service are listed under the
<em>runners</em> property under the top-level <em>execution</em> property.
The runners’ definition is a mapping where each key is an identifier
of the runner and each value is an object defining the runner.
It needs to contain at least a <em>type</em> property defining the class
of the runner. The type can be accompanied by a <em>parameters</em> property
containing keyword arguments that will be passed to the runner’s
initializer. The available parameters vary depending on the runner
class. If no selector is specified, a runner having a <em>“default”</em>
identifier is always selected.</p>
<p>Currently, slivka supports four execution methods: <em>shell</em>, <em>slivka
queue</em>, <em>univa grid engine</em> and <em>slurm</em>.</p>
<p>The simplest of them, the <code class="docutils literal notranslate"><span class="pre">ShellRunner</span></code> runs programs in a default
shell as child processes. It is simple and sufficient for very low
workloads and few simultaneous jobs, however, it can easily exhaust
all system resources if too many processes are running at once.
The use of the <code class="docutils literal notranslate"><span class="pre">ShellRunner</span></code> is highly discouraged in production
or outside small internal networks.</p>
<p>A <em>local-queue</em> and an accompanying <code class="docutils literal notranslate"><span class="pre">SlivkaQueueRunner</span></code> offer an
improved way to spawn processes. The local queue is a separate
process which maintains a queue of pending jobs and starts new child
processes only if there is an available slot, making sure that only a
limited number of subprocesses are running at the time. The local
queues can be moved to different nodes or VMs (as long as they share
the file system with the main slivka process). The
<code class="docutils literal notranslate"><span class="pre">SlivkaQueueRunner</span></code> accepts one parameter: <code class="docutils literal notranslate"><span class="pre">address</span></code> locating the
socket the local queue is listening on. If not provided, the address
from the main configuration file is used.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">GridEngineRunner</span></code> utilizes <a class="reference external" href="https://www.altair.com/grid-engine/">Univa/Altair Grid Engine</a>, a
third-party queuing system, to execute jobs. It wraps received
commands in shell scripts and sends them to the grid engine using a
<strong class="program">qsub</strong> command. <code class="docutils literal notranslate"><span class="pre">GridEngineRunner</span></code> accepts a single
<code class="docutils literal notranslate"><span class="pre">qargs</span></code> parameter containing a list of arguments that will be
directly appended to the <strong class="program">qsub</strong> command. Note that slivka
always adds <code class="docutils literal notranslate"><span class="pre">-V</span> <span class="pre">--cwd</span> <span class="pre">-o</span> <span class="pre">stdout</span> <span class="pre">-e</span> <span class="pre">stderr</span></code> arguments to the command
line and they should not be overridden.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">SlurmRunner</span></code> uses a <a class="reference external" href="https://slurm.schedmd.com/">Slurm</a> workload manager to execute jobs. It
wraps received commands in bash scripts and submits them to Slurm
using a <strong class="program">sbatch</strong> command. <code class="docutils literal notranslate"><span class="pre">SlurmRunner</span></code> accepts a single
<code class="docutils literal notranslate"><span class="pre">sbatchargs</span></code> parameters containing a list of arguments that will be
directly appended to the <strong class="program">sbatch</strong> command. Slivka
automatically includes <code class="docutils literal notranslate"><span class="pre">--output=stdout</span> <span class="pre">--error=stderr</span> <span class="pre">--parsable</span></code>
arguments which should not be overridden.</p>
<section id="selector">
<h4>Selector<a class="headerlink" href="#selector" title="Permalink to this heading">¶</a></h4>
<p>Using selectors is an advanced topic which will be covered in the
<a class="reference internal" href="specification.html#execution-management"><span class="std std-ref">Execution management</span></a> section of the advanced usage. The
selector is a python function or a class which takes a mapping of
input parameters and command line arguments and outputs an identifier
of the runner to be used. If more than one runner is defined under the
<em>runners</em> property then the role of the selector is to choose one of
those runners based on the job inputs. It allows the allocation of
different resources depending on the size or nature of the submitted
job. If no identifier is returned then the job request is rejected. If
only one runner is used regardless of the inputs, it should be named
<code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code> and the <em>selector</em> property may be omitted. In that
case, a default selector which always selects a default runner is
used.</p>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Getting Started</a><ul>
<li><a class="reference internal" href="#a-minimal-application">A Minimal Application</a></li>
<li><a class="reference internal" href="#structure-of-slivka">Structure of Slivka</a><ul>
<li><a class="reference internal" href="#configuration-files">Configuration files</a></li>
<li><a class="reference internal" href="#directory-structure">Directory Structure</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-service">Example Service</a><ul>
<li><a class="reference internal" href="#metadata">Metadata</a></li>
<li><a class="reference internal" href="#input-parameters">Input Parameters</a></li>
<li><a class="reference internal" href="#command">Command</a></li>
<li><a class="reference internal" href="#program-arguments">Program Arguments</a></li>
<li><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li><a class="reference internal" href="#output-files">Output files</a></li>
<li><a class="reference internal" href="#execution-management">Execution Management</a><ul>
<li><a class="reference internal" href="#selector">Selector</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="installation.html"
                          title="previous chapter">Installation</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="specification.html"
                          title="next chapter">Configuration</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/getting_started.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="specification.html" title="Configuration"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">slivka 0.8.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Getting Started</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Mateusz Maciej Warowny.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>