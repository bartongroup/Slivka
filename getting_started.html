
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Getting Started &#8212; slivka 0.8.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration" href="specification.html" />
    <link rel="prev" title="Welcome to slivka’s documentation!" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="specification.html" title="Configuration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to slivka’s documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">slivka 0.8.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Getting Started</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Slivka is a free software which provides easy and convenient means
for creating web services on your local computer, server or cluster.
It is written in Python and is available both as a source code or from anaconda.</p>
<p>The core of the system is the scheduler which manages jobs execution,
parses command line arguments and delegates tasks to runners that
start new processes. It uses mongo database to store and exchange data
with the REST server which communicates with client applications –
takes their requests and provides information about running jobs.</p>
<figure class="align-default" id="id3">
<img alt="_images/overview.svg" src="_images/overview.svg" /><figcaption>
<p><span class="caption-text">Diagram of interactions between slivka system components.
The REST server pushes new requests to the database where
the scheduler picks them from and dispatches to the correct
runner. The instructions how to create web services and run
command line programs are taken from the config files.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="scheduler">
<h3>Scheduler<a class="headerlink" href="#scheduler" title="Permalink to this headline">¶</a></h3>
<p>The scheduler sits in the middle of the job processing and controls other
components.
When the scheduler is started, it creates runners (more on that later)
for each web service specified in the configuration files.
After that, it enters its main operation mode in which it constantly monitors
the database and running jobs. Whenever a new request appears in the
database, the scheduler converts job parameters such as files, flags
and other input provided by the user into command line arguments.
They are then passed to the runner for execution and the scheduler
starts watching the job execution and writes its current status
back to the database.</p>
</section>
<section id="rest-server">
<h3>REST server<a class="headerlink" href="#rest-server" title="Permalink to this headline">¶</a></h3>
<p>REST server complements the scheduler providing a web interface
which users and client applications can use to submit new jobs
to the system.
On startup, it creates a form for each service specified in the
configuration file. The form contains the list of parameters
which the user is expected to provide to start the job.
Each parameter comes with label, description, type and
optional constraints telling the user what values are allowed.
When the job request with input parameters is received from the
client, the values are validated and, if correct, saved to
the database for the scheduler to pick them up.
As the job is running, the server also provides job status monitoring
and retrieving output files.</p>
</section>
<section id="runners">
<h3>Runners<a class="headerlink" href="#runners" title="Permalink to this headline">¶</a></h3>
<p>While talking about the scheduler, we mentioned that it passes jobs to
the runners for execution. Runners are internal parts of the slivka system
(custom Runners can be created though) providing an interface
between the scheduler and the software available on the operating system.
Each runner provides code that can start command line programs
and monitor their execution state. If you are an advanced user,
this allows you to write plug-ins that run your programs in new ways.</p>
</section>
<section id="config-files">
<h3>Config files<a class="headerlink" href="#config-files" title="Permalink to this headline">¶</a></h3>
<p>Configuration files contain parameters controlling the behaviour of slivka
and also serve as description of services (programs) that can be run with it.
The configuration files are situated outside of the slivka package to
guarantee portability and better isolation from the slivka internals.
As a system administrator, you are responsible for creating and maintaining
those configuration files, so the rest of this tutorial will be mostly
dedicated to them.</p>
</section>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Slivka is provided as a source code and as an Anaconda package. Using
conda is strongly recommended, but it can also be installed with pip
or setuptools once the source code is obtained. Make sure that the
programs you intend to run are accessible from where the slivka is
installed (machine or VM). They don’t have to be in the same virtual
python/conda environment though.</p>
<p>Installation requires Python 3.5+ (version 3.7 recommended).
Additional requirements will be downloaded and installed
automatically during slivka installation.</p>
<section id="installing-with-conda">
<h3>Installing with conda<a class="headerlink" href="#installing-with-conda" title="Permalink to this headline">¶</a></h3>
<p>Conda installation is recommended due to its simplicity. If you want
to use a dedicated virtual environment create it and install slivka
into it with the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">env</span><span class="o">&gt;</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.7</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">env</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">c</span> <span class="n">slivka</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">slivka</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="o">&lt;</span><span class="n">env</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>substituting the environment name (e.g. slivka) for <code class="docutils literal notranslate"><span class="pre">&lt;env&gt;</span></code>.
More information on how to use conda can be found in
<a class="reference external" href="https://conda.io/en/latest/">conda documentation</a>.</p>
</section>
<section id="installing-from-sources">
<h3>Installing from sources<a class="headerlink" href="#installing-from-sources" title="Permalink to this headline">¶</a></h3>
<p>If you are a developer wanting to tweak slivka code to own needs
or you simply don’t want to depend on conda then installation from
sources is the way to go.</p>
<p>Either clone the git repository <code class="docutils literal notranslate"><span class="pre">https://github.com/bartongroup/slivka.git</span></code>
or download and extract the zip archive available <a class="reference external" href="https://github.com/bartongroup/slivka/archive/dev.zip">here</a>. We suggest using
a more up-to-date development branch until the first stable version
is released.</p>
<p>Navigate to the package directory (the one containing <em>setup.py</em>) and run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
<p>You can also use a shortcut command which automatically installs slivka
from the git repository with pip</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">git</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">bartongroup</span><span class="o">/</span><span class="n">slivka</span><span class="o">.</span><span class="n">git</span><span class="nd">@dev</span>
</pre></div>
</div>
</section>
<section id="mongo-database">
<h3>Mongo database<a class="headerlink" href="#mongo-database" title="Permalink to this headline">¶</a></h3>
<p>Slivka makes use of a <a class="reference external" href="https://www.mongodb.com">mongo database</a> to store data and exchange
messages between its components which is crucial for its operation.
If you do not have mongodb running on your system you can install it
locally in your conda environment or ask your system administrator
to install it system-wide.</p>
</section>
</section>
<section id="running-slivka">
<h2>Running slivka<a class="headerlink" href="#running-slivka" title="Permalink to this headline">¶</a></h2>
<section id="creating-new-project">
<h3>Creating new project<a class="headerlink" href="#creating-new-project" title="Permalink to this headline">¶</a></h3>
<p>A slivka project is a collection of files (configuration files,
scripts, binaries) that, together, can be interpreted by slivka
to run a collection of programs as web services.
One slivka installation can be used to create and run multiple
projects independently, as long as they are in separate directories.</p>
<p>During the installation, a <code class="docutils literal notranslate"><span class="pre">slivka</span></code> executable was created and added to
the path. It is the main entry point which can be used to initialize
new projects and run the existing ones.</p>
<p>Let us start with creating an empty project. To do this, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slivka</span> <span class="n">init</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>replacing <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> with the name of the directory where the configuration
files will be stored in.
Use <code class="docutils literal notranslate"><span class="pre">.</span></code> if you wish to set-up the project in the current directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the executable is not accessible from the PATH it can also be
run as a python module</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">slivka</span> <span class="p">[</span><span class="n">args</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The newly created directory will contain default configuration files and
an example service. In the following sections we will walk through the
process of creating and configuring new services.</p>
</section>
<section id="starting-up">
<h3>Starting up<a class="headerlink" href="#starting-up" title="Permalink to this headline">¶</a></h3>
<p>At this point you are ready to launch a newly created slivka project
which already contains a dummy example service.
Navigate to the project directory and start those three processes
(make sure the mongo database is available first)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slivka</span> <span class="n">start</span> <span class="n">server</span> <span class="o">&amp;</span>
<span class="n">slivka</span> <span class="n">start</span> <span class="n">scheduler</span> <span class="o">&amp;</span>
<span class="n">slivka</span> <span class="n">start</span> <span class="n">local</span><span class="o">-</span><span class="n">queue</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>It launches a HTTP server, a scheduler and a simple worker queue locally
(<code class="docutils literal notranslate"><span class="pre">&amp;</span></code> runs them in background, use <code class="docutils literal notranslate"><span class="pre">fg</span></code> command to bring them back).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your mongo database is listening on port other than the default
or any of the ports used by slivka is already in use you can
change them in the <em>config.yaml</em> file.</p>
</div>
</section>
<section id="submitting-job">
<h3>Submitting job<a class="headerlink" href="#submitting-job" title="Permalink to this headline">¶</a></h3>
<p>In this subsection we will take a look at the data exchanged in
the  client-server communication and submit
our first job using a terminal. This knowledge is not crucial to manage
and use slivka services, so feel free to skip to the next section
if it gets too technical.</p>
<p>In the following examples we use curl, a command line tool for transferring
data over network protocols, to send and receive data from the server.
More information can be found on the <a class="reference external" href="https://curl.se/">cURL website</a>.</p>
<p>Once the slivka server is up, you can send a GET request (or open the
url in the web browser) to <a class="reference external" href="http://127.0.0.1:4040/api/services">http://127.0.0.1:4040/api/services</a>
in order to list currently available services.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl http://127.0.0.1:4040/api/services
</pre></div>
</div>
<p>The response will show a JSON formatted list of services, or one
“Example Service” to be more specific. Information about this one
service can also be requested from <a class="reference external" href="http://127.0.0.1:4040/api/services/example">/api/services/example</a>.
The response contains the information
about the service including the list of input parameters
for that service. Each parameter needs to have a value supplied when
the new job is submitted. Seeing all those parameters and their
properties may be a bit daunting, so we focus on and break
down the last one for now.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;array&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Required command line argument&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;arg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Text argument&quot;</span><span class="p">,</span>
  <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The most important property is parameter’s <em>id</em>. It is used to
reference the parameter, especially when providing a value for it.
Second most important property is parameter <em>type</em> which dictates
what values will be accepted (text, number, file, etc). <em>Array</em> tells
us whether this parameter takes multiple values which is false in this
case, and <em>required</em> tells whether the value must be provided for the
new job to be started as some parameters may be optional.
<em>Default</em> indicates what value will be used if no other value is supplied.
Finally, <em>name</em> and <em>description</em> contain human-friendly name of
the parameter accompanied by a longer commentary.</p>
<p>In order to create a new job, we send a POST request to the
<a class="reference external" href="http://127.0.0.1:4040/api/services/example/jobs">/api/services/example/jobs</a> endpoint providing values for the
parameters in the request body using either urlencoded or multipart form.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl -d<span class="s2">&quot;rep=v1&amp;rep=v2&amp;arg=val3&quot;</span> http://localhost:4040/api/services/example/jobs
</pre></div>
</div>
<p>If you followed these instructions, then you’ve just submitted your
first job to slivka.
If everything went correctly, the server response should contain
the id of the new job along with other data such as its status,
submission time and parameters used.</p>
<p>You can follow the url specified in the <em>&#64;url</em> property to view the
job resource along with the current progress status.</p>
</section>
</section>
<section id="configuring-services">
<h2>Configuring services<a class="headerlink" href="#configuring-services" title="Permalink to this headline">¶</a></h2>
<p>In this section we will take a closer look into the configuration
file of the example service and learn how to create our own services.</p>
<p>First, navigate to the <em>services</em> folder in your slivka project directory.
There is a single <em>example.service.yaml</em> file there which contains the
service configuration. Any file in this directory, whose name
ends with <em>service.yaml</em>, is automatically recognised as a service
definition. The identifier of the service is taken from the file name.
In the following sections we will go through each part of the file
one by one.</p>
<p>The configuration files are written in <a class="reference external" href="https://yaml.org/">yaml</a>, so make sure you are
familiar with the yaml syntax before continuing.</p>
<section id="service-metadata">
<h3>Service metadata<a class="headerlink" href="#service-metadata" title="Permalink to this headline">¶</a></h3>
<p>Before we start, note that the lines starting with <code class="docutils literal notranslate"><span class="pre">#</span></code> are ignored
by the program, so they can be used for making comments.
The first few lines is a good place to write a few notes
briefly describing the service including information for
anyone who is going to maintain those files in the future.</p>
<p>The topmost properties contain service metadata. They serve
an informative purpose for the users of the service.
Starting from the top we have <em>slivka-version</em> which tells the slivka
version this service was written for and compatible with.
Then, <em>name</em> and <em>description</em> contain a brief service name
(not to be confused with an identifier) and a description with more
detailed information respectively. After that, you can optionally add an
<em>author</em>, <em>version</em> of the software, software <em>license</em>, and
<em>classifiers</em> which is a list of tags that may help users or software
categorise and recognise the service.</p>
</section>
<section id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<p>The <em>parameters</em> property usually makes the biggest part of the configuration file.
This is the place where the input parameters for the service are listed
which are further mapped to the command line arguments.
If you followed the job submission guide, you may recognise those
parameters are the same that are presented to the front-end user.</p>
<p>Each key in the <em>parameters</em> mapping is a unique parameter id;
it can only contain letters, digits, dashes and underscores.
The object under each key defines the parameter. in order to get
you started, we are going to explain how to add/remove and define
service parameters based on the example service . The more detailed technical
information can be found in the <a class="reference internal" href="specification.html#parameters-specification"><span class="std std-ref">parameters specification</span></a>.</p>
<p>First of all, each parameter must have a <em>name</em> and a <em>type</em> specified.
The name differs from the identifier (key) in that it doesn’t have any
character restrictions and is for the human use only. Keep it concise and
self explanatory, so users know what that parameter is controlling.
If you need to disclose more information and details, you can add it
in a <em>description</em> which can contain longer text.</p>
<p>The parameter <em>type</em>, as the name suggests, tells users what kind
of value is expected. There are several built-in types which should
cover the majority of what command line programs need; these are:
<code class="docutils literal notranslate"><span class="pre">integer</span></code>, <code class="docutils literal notranslate"><span class="pre">decimal</span></code>, <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">flag</span></code>, <code class="docutils literal notranslate"><span class="pre">choice</span></code> and <code class="docutils literal notranslate"><span class="pre">file</span></code>.
You can immediately follow the type with a pair of square brackets to
convert it into an array so that multiple values can be provided for
that single parameter e.g. <code class="docutils literal notranslate"><span class="pre">text[]</span></code>.</p>
<p>Two properties which are frequently used, but are not required,
include: <em>default</em> that specify the value which will be used if it
is not supplied by the user (skip it if you don’t want to use
a default value) and <em>required</em> which allows to set whether
the value for that parameter must be provided for the job to be started
(default is <code class="docutils literal notranslate"><span class="pre">true</span></code>). Note that settings a default value makes the
parameter automatically optional.</p>
<p>There are also additional properties which depend on the parameter type.
The notable ones are <em>min</em> and <em>max</em> value that can be specified for
numeric types, the <em>min-length</em> and <em>max-length</em> applicable to
texts and <em>choices</em> which must be listed for a choice type.
<em>Choices</em> require a bit of explanation since it doesn’t contain
a list of choices, as would be expected, but a mapping. The keys of the
mapping is what is presented to the user, but the values are later used
in the command. This way you can hide the actual
command-line parameters and provide meaningful names for them.</p>
</section>
<section id="command">
<h3>Command<a class="headerlink" href="#command" title="Permalink to this headline">¶</a></h3>
<p>The <em>command</em> property contains the command that will be used to start
the program on the computer. It can either be a text as you would type
it into the shell or an array of arguments (similar to what you
pass to <code class="docutils literal notranslate"><span class="pre">execl</span></code> function). The latter might be particularly useful
if your command contains special characters and you want to be
sure it’ll be split into arguments correctly.</p>
<p>Environment variables can be inserted using either <code class="docutils literal notranslate"><span class="pre">$VARIABLE</span></code>
or <code class="docutils literal notranslate"><span class="pre">${VARIABLE}</span></code> syntax. A literal “$” character can be obtained
by escaping it with another dollar character like this: <code class="docutils literal notranslate"><span class="pre">$$</span></code>.
Both, current environment variables and those defined in this file
(more on customising process’ environment later) can be used.
Also, a special <code class="docutils literal notranslate"><span class="pre">SLIVKA_HOME</span></code> variable pointing to the project
directory can be used here as well.</p>
<p>In the example we run python binary to which we provide an <em>example.py</em>
located in the <em>scripts</em> folder under the project directory.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If your program or script is not directly available from the
<em>PATH</em> you <strong>must</strong> give an absolute path to it. Failing to do so
will result in all jobs failing with “file not found” error.
This is where <code class="docutils literal notranslate"><span class="pre">SLIVKA_HOME</span></code> comes in handy as it contains an
absolute path to the project root directory.</p>
</div>
</section>
<section id="arguments">
<h3>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h3>
<p>Once we have service parameters and command specified, we need to
tell slivka how to translate each parameter value to the command line
argument. Before we dive into details, we need to take a look at the
python script that will be executed. It is a dummy program, that
takes several parameters as command line arguments and produces some
text. Its usage can be summarised as follows</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>example.py <span class="o">[</span>--infile FILE<span class="o">]</span> <span class="o">[</span>--opt TEXT<span class="o">]</span> <span class="o">[</span>--rep REP<span class="o">[</span>,REP,...<span class="o">]]</span> <span class="se">\</span>
  <span class="o">[</span>--delay SECONDS<span class="o">]</span> <span class="o">[</span>--letter LETTER<span class="o">]</span> <span class="o">[</span>--flag<span class="o">]</span> -- ARG
</pre></div>
</div>
<p>Here, optional parts are enclosed in brackets. As we can see, the
script takes a few optional arguments (one of which takes multiple,
comma-separated values) followed by a double dash and
a single required argument.</p>
<p>As you might have already noticed, those arguments match the
parameters and arguments specified in the service definition file.
For each argument in the command, we have an entry in the <em>args</em>
mapping. The entry value is an object which must at least have
<em>arg</em> property that contains a template for the command line argument.
For each of those entries, slivka tries to find a parameter with
a matching id and, if found, it replaces a user-provided value for the
<code class="docutils literal notranslate"><span class="pre">$(value)</span></code> placeholder.</p>
<p>We’ll now explain all the arguments in the service file one-by-one.
Let us skip the first entry for now and move on to the <em>opt</em> item.
It is a simple optional text parameter
passed to the command as <code class="docutils literal notranslate"><span class="pre">--opt</span> <span class="pre">$(value)</span></code>. When users submit new jobs,
whatever value they provide as <em>opt</em> will be inserted in place of
the placeholder. You should not worry about special characters and
spaces as slivka will automatically quote and escape any of them.
It is also possible to use environment variables here. The rules for
using environment variables are the same as for <a class="reference internal" href="#command">command</a>.</p>
<p>Next one is <em>rep</em>, similar to the <em>opt</em> parameter, this one is a
text parameter, however, it can take multiple values as well.
In addition to <em>arg</em> it also has <em>join</em> property which tells what
character should be used to join multiple values into one argument.
As a result, the output will be <code class="docutils literal notranslate"><span class="pre">--rep</span> <span class="pre">valA,valB,valC`</span></code>.
If <em>join</em> is not specified, then the whole argument is repeated
multiple times. This would result in <code class="docutils literal notranslate"><span class="pre">--rep</span> <span class="pre">valA</span> <span class="pre">--rep</span> <span class="pre">valB</span> <span class="pre">--rep</span> <span class="pre">valC</span></code>.</p>
<p>The <em>delay</em> parameter is a numeric type, but since all values are
converted to strings implicitly it doesn’t require any special treatment.</p>
<p>The <em>letter</em> parameter behaves similar to a plain text parameter,
however, it’s important to remember that values are converted
according to the <em>choices</em> mapping in the parameter definition prior
to being passed to the command line.</p>
<p>Moving on, <em>flag</em> (flag/boolean type) is a bit unusual as it doesn’t
use a value and instead operates in the present/absent fashion.
Under the hood, flags do actually have a value which is either <code class="docutils literal notranslate"><span class="pre">&quot;true&quot;</span></code>
string literal if enabled or no value if disabled which results in
the parameter being skipped.</p>
<p>After the list of optional parameters we need to place <code class="docutils literal notranslate"><span class="pre">--</span></code> before
the final argument. In order to place a constant in the command line
we can specify it like any other argument. Since it does not have
a corresponding input parameter, we need to specify a dummy default
value or the argument will be skipped due to the missing value.
For distinction, you can give it an id starting with an underscore.</p>
<p>The last parameter is passed to the command as is, without additional
prefixes, hence the value of <em>arg</em> contains <code class="docutils literal notranslate"><span class="pre">$(value)</span></code> only.</p>
<p>Last but not least, we explain the <em>input-file</em> argument. The file-type
parameters are converted to filesystem paths prior to being passed
to the command line and, for all intends and purposes, can be treated
as any other string.
Those paths are absolute and are not pointing to the
working directory where the program is run, which well-behaved
programs should have no problems with. However, in case the program you use
requires the input file to be present in it’s working directory, the
solution is to add a <em>symlink</em> property to the argument definition.
This will make slivka create a symbolic link to the file inside the
program’s working directory and insert
a relative path to the symlink in place of the original value.</p>
<p>The last thing to mention is that slivka constructs the command line
arguments in the same order as they appear in the <em>args</em> which does
not need to be the same order as in the <em>parameters</em>.
Also, any argument whose value is missing or is null is dropped from
the command.</p>
</section>
<section id="environment-variables">
<h3>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h3>
<p>If your program requires special environment variables to be set, or
you want to create a convenient alias for a value you can do it
in the <em>env</em> property. It contains a mapping of environment variable
names to their values that will be set when starting the command.
You can use system environment variables here as well (you can’t make
references to other variables defined here though).</p>
<p>In our example, we have an alias for <code class="docutils literal notranslate"><span class="pre">/usr/bin/env</span> <span class="pre">python</span></code> stored
in <code class="docutils literal notranslate"><span class="pre">PYTHON</span></code> variable. We could have then used the aliased line
in the command by simply typing <code class="docutils literal notranslate"><span class="pre">$PYTHON</span></code>.
We also re-define <code class="docutils literal notranslate"><span class="pre">PATH</span></code> to contain the <em>bin</em> folder from the
project directory followed by the original value of <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.</p>
<p>Slivka runs every command in a modified environment with all system
variables except <code class="docutils literal notranslate"><span class="pre">PATH</span></code> removed. If you need any variable
to be visible, you need to re-define it in <em>env</em>. e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">env</span><span class="p">:</span>
  <span class="nt">VARIABLE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${VARIABLE}</span>
</pre></div>
</div>
</section>
<section id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h3>
<p>The course of action following the successful (or not) execution of the
program is collecting the results it produced. They usually come in
the form of the output files and/or the text written to the output
and error streams.</p>
<p>The <em>outputs</em> property enumerates all output files that will be
presented to the users. Each key represents an id of the result
which may be one, or a collection of files. The only required
property of the result object is <em>path</em> containing a relative path
or a <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)">glob</a> pattern that will be used to identify the file.
The standard output and error streams are written to <em>stdout</em> and
<em>stderr</em> files respectively and can be referred to as such.</p>
<p>Additionally, you can provide additional metadata such as a
human-readable <em>name</em> or <em>media-type</em> (as discussed in <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc2045">RFC 2045</a>)
to help software recognise the content they are dealing with.</p>
</section>
<section id="execution-manager">
<h3>Execution manager<a class="headerlink" href="#execution-manager" title="Permalink to this headline">¶</a></h3>
<p>Once the program’s inputs and output are all worked out, it’s finally
time to instruct slivka how to run the program. If your programs
doesn’t put heavy loads on the machine and you have tiny user base,
you might get away with running them in a current shell. But, you
risk using up all the resources really quick if more using start
running more intensive programs. This is where runners comes into play.</p>
<section id="runners-overview">
<h4>Runners overview<a class="headerlink" href="#runners-overview" title="Permalink to this headline">¶</a></h4>
<p>The runner is a simple Python snippet that can take your carefully
prepared command and execute it in whatever way it was written to
do it. Currently, slivka has three built-in runners: <code class="docutils literal notranslate"><span class="pre">ShellRunner</span></code>,
<code class="docutils literal notranslate"><span class="pre">SlivkaQueueRunner</span></code> and <code class="docutils literal notranslate"><span class="pre">GridEngineRunner</span></code>. This list will definitely
expand in the future as slivka will grow.</p>
<p>Starting with the simplest one, <code class="docutils literal notranslate"><span class="pre">ShellRunner</span></code> just spawns each job
as a new process in the current shell, nothing more. It’s sufficient
if you are dealing with very low number of jobs as it doesn’t require
any prior setup to work. Although, since there is no control
or limit on the number of simultaneous processes, it can easily
clog your system if one user decides to start hundred jobs at once.</p>
<p>A next improvement step is <code class="docutils literal notranslate"><span class="pre">SlivkaQueueRunner</span></code>. It sends the jobs
to the separate process (that must be started first with
<code class="docutils literal notranslate"><span class="pre">slivka</span> <span class="pre">start</span> <span class="pre">local-queue</span></code>) that in turn runs them in the shell.
It may look just like running jobs in the current shell with extra step
in between but this step actually gives some advantages. First of all,
the queue may run on a different node or machine, so if the jobs start
to take too many resources, they won’t clog the rest of the system.
Also, slivka queue keeps track of the number of running processes
and puts new job in the queue if their number exceeds a set limit.
It’s far from being the proper system resources management system,
but it’s intended to be lightweight and simple.</p>
<p>The last one, <code class="docutils literal notranslate"><span class="pre">GridEngineRunner</span></code> utilizes a third-party queuing
system to manage job execution. It dispatches received jobs to
the Grid Engine using <code class="docutils literal notranslate"><span class="pre">qsub</span></code> command and lets it do all the
resource management. You can tweak the execution parameters by
adding additional parameters that will be passed to <code class="docutils literal notranslate"><span class="pre">qsub</span></code>.
This is certainly most advanced solution suitable
for very large systems that have Grid Engine set up.</p>
</section>
<section id="specifying-runners">
<h4>Specifying runners<a class="headerlink" href="#specifying-runners" title="Permalink to this headline">¶</a></h4>
<p>Runners available for the service are listed under <em>runners</em> inside
the <em>execution</em> property. Under each key, which is runner id,
you need to specify runner <em>type</em> from one of the available types.
You can additionally provide additional <em>parameters</em> depending on the
runner. We won’t go into details here as they are available in the
<a class="reference internal" href="specification.html#execution-management"><span class="std std-ref">Execution management</span></a> section.</p>
</section>
<section id="selector">
<h4>Selector<a class="headerlink" href="#selector" title="Permalink to this headline">¶</a></h4>
<p>The last bit that remains to be explained is the <em>selector</em>.
In some cases you may need to have a fine grained control over
which runner is used depending on job parameters. One of the examples
is allocating different amount of memory depending on the data size.
If there is more than one runner defined then the python function
which the <em>selector</em> path is pointing to is called with command
line parameters as an argument. The function then needs to return
an identifier of the runner that will be used to run the command.
This is an advanced functionality which is beyond the introductory
tutorial, but it’s noteworthy. If you want to use one runner only
name it <code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code> and remove <em>selector</em> line from the file.</p>
</section>
</section>
<section id="build-your-service">
<h3>Build your service<a class="headerlink" href="#build-your-service" title="Permalink to this headline">¶</a></h3>
<p>This is all for the basic tutorial. At this point you should
be able to modify and create simple web services with slivka.
Let us finish it with an exercise.
Try creating a <em>greeter</em> service which takes a name
from the user with a single input parameter and uses <code class="docutils literal notranslate"><span class="pre">echo</span></code>
command to output “Hello &lt;name&gt;. Have a nice day.” to the standard
output stream.</p>
<p>After that, start slivka and try submitting the job to your service and
retrieve the result.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Getting Started</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#scheduler">Scheduler</a></li>
<li><a class="reference internal" href="#rest-server">REST server</a></li>
<li><a class="reference internal" href="#runners">Runners</a></li>
<li><a class="reference internal" href="#config-files">Config files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#installing-with-conda">Installing with conda</a></li>
<li><a class="reference internal" href="#installing-from-sources">Installing from sources</a></li>
<li><a class="reference internal" href="#mongo-database">Mongo database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-slivka">Running slivka</a><ul>
<li><a class="reference internal" href="#creating-new-project">Creating new project</a></li>
<li><a class="reference internal" href="#starting-up">Starting up</a></li>
<li><a class="reference internal" href="#submitting-job">Submitting job</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-services">Configuring services</a><ul>
<li><a class="reference internal" href="#service-metadata">Service metadata</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#command">Command</a></li>
<li><a class="reference internal" href="#arguments">Arguments</a></li>
<li><a class="reference internal" href="#environment-variables">Environment variables</a></li>
<li><a class="reference internal" href="#outputs">Outputs</a></li>
<li><a class="reference internal" href="#execution-manager">Execution manager</a><ul>
<li><a class="reference internal" href="#runners-overview">Runners overview</a></li>
<li><a class="reference internal" href="#specifying-runners">Specifying runners</a></li>
<li><a class="reference internal" href="#selector">Selector</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-your-service">Build your service</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to slivka’s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="specification.html"
                        title="next chapter">Configuration</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/getting_started.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="specification.html" title="Configuration"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to slivka’s documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">slivka 0.8.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Getting Started</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Mateusz Maciej Warowny.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
    </div>
  </body>
</html>