
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Configuration &#8212; slivka 0.8.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced Usage" href="advanced_usage.html" />
    <link rel="prev" title="Getting Started" href="getting_started.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="advanced_usage.html" title="Advanced Usage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">slivka 0.8.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Configuration</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<section id="project-structure">
<h2>Project Structure<a class="headerlink" href="#project-structure" title="Permalink to this headline">¶</a></h2>
<p>The collection of configuration files used be slivka is referred to
as a slivka project. The root directory housing other configuration
files is referred to as a slivka home directory. On startup, slivka
also creates an environment variable <code class="docutils literal notranslate"><span class="pre">SLIVKA_HOME</span></code> pointing to that
directory, which can be used throughout the configuration files and
scripts.</p>
<p>Each project contains few files essential for the proper operation
of slivka. Those are:</p>
<dl class="field-list simple">
<dt class="field-odd">config.yaml</dt>
<dd class="field-odd"><p>Main configuration file of the slivka project, required for its
proper functionality.
Typically, slivka recognises the project directory as
the one containing this file. Alternatively, it can be named
<em>settings.yaml</em> and either <em>.yaml</em> or <em>.yml</em> extension is allowed.
The detailed information about the file syntax and parameters is
provided in the <a class="reference internal" href="#configuration-file">configuration file</a> section.</p>
</dd>
<dt class="field-even">wsgi.py</dt>
<dd class="field-even"><p>A python module file containing a wsgi-compatible application as specified in
<a class="reference external" href="https://www.python.org/dev/peps/pep-3333/">PEP-3333</a>. This file is used by wsgi middleware to serve slivka
http endpoints. You may want to use this file if you plan to use
an unsupported middleware or have more control over execution parameters.</p>
</dd>
<dt class="field-odd">manage.py</dt>
<dd class="field-odd"><p>A legacy executable script that may be used to load configuration
files and start slivka processes. It’s functionality is fully replaced
by the newer <em>slivka</em> executable.</p>
</dd>
<dt class="field-even">services</dt>
<dd class="field-even"><p>A default directory containing service configuration files. Each file
in the directory whose name ends with <em>.service.yaml</em> is considered
a slivka service file. The directory can be changed in the main
configuration file.</p>
</dd>
</dl>
<p>All the configuration files are using <a class="reference external" href="https://yaml.org/">YAML</a> syntax
and can be edited with any text editor.
If you are not familiar with YAML structure you can use JSON instead since
any JSON document is a valid YAML document as well.</p>
<p>It’s not advisable to edit <em>manage.py</em> and <em>wsgi.py</em> scripts unless
you are an advanced user and you know what you are doing.</p>
</section>
<section id="configuration-file">
<h2>Configuration file<a class="headerlink" href="#configuration-file" title="Permalink to this headline">¶</a></h2>
<p><em>config.yaml</em> is the main configuration file of the project and
stores values used across the application.
The properties in the file can be structured as a tree or a flat mapping
as shown in the following snippets respectively. Both forms are equivalent.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">directory.uploads</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">media/uploads</span>
<span class="nt">directory.jobs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">media/jobs</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">directory</span><span class="p">:</span>
  <span class="nt">uploads</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">media/uploads</span>
  <span class="nt">jobs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">media/jobs</span>
</pre></div>
</div>
<p>Here is the list of parameters that can be defined in the file.
All of them are required unless stated otherwise.</p>
<dl class="field-list simple">
<dt class="field-odd"><em>version</em></dt>
<dd class="field-odd"><p>Version of the configuration file syntax used to check for project
compatibility. For the current slivka version this must be set to <code class="docutils literal notranslate"><span class="pre">&quot;0.3&quot;</span></code>.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd"><em>directory.uploads</em></dt>
<dd class="field-odd"><p>Path to a directory where the files uploaded by the users will be stored.
A relative path is resolved with respect to the project
directory. It’s recommended to set the proxy server to serve
those files directly, i.e. under <em>/uploads</em> path (configurable
by changing <code class="docutils literal notranslate"><span class="pre">server.uploads-path</span></code>).
Default is <code class="docutils literal notranslate"><span class="pre">&quot;./media/uploads&quot;</span></code>.</p>
</dd>
<dt class="field-even"><em>directory.jobs</em></dt>
<dd class="field-even"><p>Path to a directory where the job sub-directories will be created.
For each job, slivka creates a sub-directory there and sets it as a
current working directory.
A relative path is resolved with respect to the project directory.
It’s recommended to set the proxy server to serve those files
directly, i.e. under <em>/jobs</em> path (configurable by changing
<code class="docutils literal notranslate"><span class="pre">server.jobs-path</span></code>).
Default is <code class="docutils literal notranslate"><span class="pre">&quot;./media/jobs&quot;</span></code></p>
</dd>
<dt class="field-odd"><em>directory.logs</em></dt>
<dd class="field-odd"><p>Path to the directory where the log files will be stored.
Default is <code class="docutils literal notranslate"><span class="pre">&quot;./logs&quot;</span></code></p>
</dd>
<dt class="field-even"><em>directory.services</em></dt>
<dd class="field-even"><p>Path to the directory containing service definition files.
Slivka automatically detects files under this directory whose
names end with <code class="docutils literal notranslate"><span class="pre">.service.yaml</span></code> as services and loads them on startup.
Default is <code class="docutils literal notranslate"><span class="pre">&quot;./services&quot;</span></code></p>
</dd>
</dl>
<dl class="field-list">
<dt class="field-odd"><em>server.host</em></dt>
<dd class="field-odd"><p>Address and port under which slivka application is hosted.
It’s highly recommended to run slivka behind a HTTP proxy server
such as <a class="reference external" href="https://nginx.org/">nginx</a>, <a class="reference external" href="https://httpd.apache.org/">Apache HTTP Server</a> or <a class="reference external" href="https://www.lighttpd.net/">lighttpd</a> ,
so no external traffic connects to the wsgi server directly.
Set the value to the address where the proxy server connect from or
<code class="docutils literal notranslate"><span class="pre">0.0.0.0</span></code> to accept connections from anywhere (not recommended).
Default is <code class="docutils literal notranslate"><span class="pre">127.0.0.1:4040</span></code>.</p>
</dd>
<dt class="field-even"><em>server.uploads-path</em></dt>
<dd class="field-even"><p>Path where the uploaded files are served at. It should be set to
the same path that the proxy server uses to serve files from the
uploads directory (set in <em>directory.uploads</em> parameter).
Default is <code class="docutils literal notranslate"><span class="pre">&quot;/media/uploads&quot;</span></code>.</p>
</dd>
<dt class="field-odd"><em>server.jobs-path</em></dt>
<dd class="field-odd"><p>Path where the job results are server at. It should be set to the
same path that the proxy server uses to server files from the
jobs directory (set in <em>directory.jobs</em> parameter).
Default is <code class="docutils literal notranslate"><span class="pre">&quot;/media/jobs&quot;</span></code>.</p>
</dd>
<dt class="field-even"><em>server.prefix</em></dt>
<dd class="field-even"><p><em>(optional)</em> Url path that the proxy server serves the application
under if other then root. This is needed for the urls and redirects
to work properly. For example, if you configured your proxy
server to redirect all requests starting with <em>/slivka</em> to the
wsgi application, then set the prefix value to <code class="docutils literal notranslate"><span class="pre">/slivka</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Configure your proxy rewrite rule to <strong>not</strong> remove the prefix
from the url.</p>
</div>
</dd>
</dl>
<dl class="field-list">
<dt class="field-odd"><em>local-queue.host</em></dt>
<dd class="field-odd"><p>Host and port where the local queue server will listen to commands on.
Use localhost address or a named socket that only trusted users
(i.e. slivka) can write to.
You may specify the protocol <code class="docutils literal notranslate"><span class="pre">tcp://</span></code> for tcp connections.
The <code class="docutils literal notranslate"><span class="pre">ipc://</span></code> or <code class="docutils literal notranslate"><span class="pre">unix://</span></code> protocol must be specified when using
named sockets.
Default is <code class="docutils literal notranslate"><span class="pre">tcp://127.0.0.1:4041</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>NEVER ALLOW UNTRUSTED CONNECTIONS TO THAT ADDRESS since arbitrary
code may be sent to and executed by the queue.</p>
</div>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd"><em>mongodb.host</em></dt>
<dd class="field-odd"><p><em>(optional)</em> Address and port of the mongo database that slivka will connect to.
Either one of this or <em>mongodb.socket</em> parameter must be present.
Default is <code class="docutils literal notranslate"><span class="pre">127.0.0.1:27017</span></code>.</p>
</dd>
<dt class="field-even"><em>mongodb.socket</em></dt>
<dd class="field-even"><p><em>(optional)</em> Named socket where mongo database accepts connections at.
Either one of this or <em>mongodb.host</em> parameter must be present.</p>
</dd>
<dt class="field-odd"><em>mongodb.username</em></dt>
<dd class="field-odd"><p><em>(optional)</em> Username that the application will use to log in to the
database. A default user will be used if not provided.
Default is unset.</p>
</dd>
<dt class="field-even"><em>mongodb.password</em></dt>
<dd class="field-even"><p><em>(optional)</em> Password used to authenticate the user when connecting
to the database. Default is unset.</p>
</dd>
<dt class="field-odd"><em>mongodb.database</em></dt>
<dd class="field-odd"><p>Database that will be used by slivka application to store data.
Default is <code class="docutils literal notranslate"><span class="pre">slivka</span></code></p>
</dd>
</dl>
</section>
<section id="service-configuration">
<h2>Service configuration<a class="headerlink" href="#service-configuration" title="Permalink to this headline">¶</a></h2>
<p>Web services can be added to the project by creating service definition
files in the services directory specified in the configuration file
(<em>services/</em> by default).
Each service definition is stored in its unique file named
<em>&lt;service-id&gt;.service.yaml</em> where the service identifier should be
substituted for the <em>&lt;service-id&gt;</em>.
The filename (without the extension) should contain alphanumeric
characters, dashes and underscores only (avoid using spaces) and
will be used as a unique service identifier.
Using lowercase letters is strongly recommended but not required.
Those files store service information, command line
program that will be run, the list of arguments to
that program as well as the additional constraints on those input
parameters.</p>
<section id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<p>On top of the file there are service metadata, that is, all information
about the service which are not instructions for slivka.
Even though the order in which the keys are defined in the file does
not matter, it’s a good practise to place general service information
on top.
Additionally, you can accompany the data with comments (lines starting
with <code class="docutils literal notranslate"><span class="pre">#</span></code>), although comments are ignored by the program.</p>
<p>Here is the full list of metadata parameters that can be set in the file.</p>
<dl class="field-list">
<dt class="field-odd"><em>slivka-version</em></dt>
<dd class="field-odd"><p>The version of slivka this service was written for. It helps
slivka detect any compatibility issues related to syntax changes.
For the current version use <code class="docutils literal notranslate"><span class="pre">&quot;0.8&quot;</span></code>.</p>
</dd>
<dt class="field-even"><em>name</em></dt>
<dd class="field-even"><p>Service name should be concise and self-explanatory. For example,
indicating the name of the program that it runs.</p>
</dd>
<dt class="field-odd"><em>description</em></dt>
<dd class="field-odd"><p><em>(optional)</em> Long text which provides additional information about
the service. It might provide an explanation what the service does
and how it works.</p>
</dd>
<dt class="field-even"><em>author</em></dt>
<dd class="field-even"><p><em>(optional)</em> One or more authors of the command line program used.</p>
</dd>
<dt class="field-odd"><em>version</em></dt>
<dd class="field-odd"><p><em>(optional)</em> Version of the command line program. Specifying it
might prove useful when multiple versions of the same software is
served. Remember to quote the version number so it’s interpreted
as a string.</p>
</dd>
<dt class="field-even"><em>license</em></dt>
<dd class="field-even"><p><em>(optional)</em> License under which the service or the underlying
program is used and distributed.</p>
</dd>
<dt class="field-odd"><em>classifiers</em></dt>
<dd class="field-odd"><p><em>(optional)</em> List of tags that helps users and client software group and
identify services. The classifiers can be chosen arbitrarily, but
some client software may rely on those to function properly.</p>
<p>Example from the clustalw2 service definition:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">classifiers</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="s">&quot;Topic</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">Sequence</span><span class="nv"> </span><span class="s">analysis&quot;</span>
<span class="p p-Indicator">-</span> <span class="s">&quot;Operation</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">Multiple</span><span class="nv"> </span><span class="s">sequence</span><span class="nv"> </span><span class="s">alignment&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="command">
<h3>Command<a class="headerlink" href="#command" title="Permalink to this headline">¶</a></h3>
<p>The rest of the service file contains instructions for slivka how
to run the command line program and what parameters the web service
part should expose to the users.
Let us start with defining the command line program and its arguments
followed by listing the output files.
Then, we use the command arguments to build the parameters for the
web services.
Lastly, we briefly mention available execution methods for job processes.</p>
<section id="base-command">
<h4>Base Command<a class="headerlink" href="#base-command" title="Permalink to this headline">¶</a></h4>
<p>The base command (i.e. the program to be run) is specified under the
<em>command</em> property. In simple cases this will contain an executable
to be run such as <code class="docutils literal notranslate"><span class="pre">clustalw2</span></code> or <code class="docutils literal notranslate"><span class="pre">mafft</span></code>; however, it is also
possible to name multiple arguments or even insert environment
variables e.g. <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">${HOME}/lib/my-library</span></code>. This part will
make the base of our program call and additional arguments will be
appended to that.</p>
<p>If you are concerned about special characters and whitespace and
want to make sure that the command is read properly, you can enumerate
the arguments using a list as shown in the following examples.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">clustalw2</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python -m ${HOME}/lib/my-library</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bash</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-rx</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${SLIVKA_HOME}/bin/my-script.sh</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Subprocesses are not executed in the same working directory as slivka,
so if A program is not accessible from the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> an absolute
path to is must be given. A special <code class="docutils literal notranslate"><span class="pre">SLIVKA_HOME</span></code> variable may be
used to refer to the root directory of the slivka project.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Never use commands that execute code coming from the users which
allow script injections. One example is using <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">-c</span></code>.</p>
</div>
</section>
<section id="arguments">
<h4>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h4>
<p>Once the base command is set up, we can move on to enumerating the command
line arguments for the program. Those are placed under the <code class="docutils literal notranslate"><span class="pre">args</span></code>
property in the service configuration file. It contains an ordered
mapping where each key is a parameter id (we’ll need it later)
and values are argument objects with following attributes</p>
<dl class="field-list">
<dt class="field-odd"><em>arg</em></dt>
<dd class="field-odd"><p>The argument template which will be inserted into the command.
Whenever the value for the parameter is not empty, that argument
is appended to the list of arguments with the actual value
substituted for the <code class="docutils literal notranslate"><span class="pre">$(value)</span></code> placeholder.
Example: <code class="docutils literal notranslate"><span class="pre">--type=$(value)</span></code></p>
<p>Using environment variables in the argument value is supported.</p>
</dd>
<dt class="field-even"><em>default</em></dt>
<dd class="field-even"><p><em>(optional)</em>
Value that will be used when no other value was provided for the
argument. One use is to provide constant values for parameters
hidden from the front-end users.</p>
</dd>
<dt class="field-odd"><em>join</em></dt>
<dd class="field-odd"><p><em>(optional)</em>
Delimiter used to join multiple values for the argument.
Only applicable to parameters that can take multiple values.
If <em>join</em> is not specified then the argument is repeated multiple
times for each value. For example, for two values <code class="docutils literal notranslate"><span class="pre">alpha</span></code>, <code class="docutils literal notranslate"><span class="pre">bravo</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">arg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-p $(value)</span>
</pre></div>
</div>
<p>will result in command arguments <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">alpha</span> <span class="pre">-p</span> <span class="pre">bravo</span></code>, but</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">arg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-p $(value)</span>
<span class="nt">join</span><span class="p">:</span> <span class="s">&quot;,&quot;</span>
</pre></div>
</div>
<p>will result in <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">alpha,bravo</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since arguments splitting happens before interpolation,
using space as the delimiter produces single argument.
In the example above, it would result in <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">&quot;alpha</span> <span class="pre">bravo&quot;</span></code>
not <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">alpha</span> <span class="pre">bravo</span></code>.</p>
</div>
</dd>
<dt class="field-even"><em>symlink</em></dt>
<dd class="field-even"><p><em>(optional)</em>
Instructs slivka to create symbolic link to the file in the process’
working directory. Only applicable to parameters that take files
as an input. When <em>symlink</em> is present, the value of the parameter
will be replaced by the symlink name pointing to the original path.</p>
</dd>
</dl>
</section>
</section>
<section id="environment-variables">
<h3>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h3>
<p>If the program you wrap needs specific environment variables or
you need to adjust existing variables they can be specified under
the <em>env</em> property. It should contain a mapping where each key
is a variable name that will be set to its corresponding value
when starting the command. The value can contain current environment
variables which are included using <code class="docutils literal notranslate"><span class="pre">${VARIABLE}</span></code> syntax. Although
any system variable can be used, references to other variables
defined in this mapping will not work.</p>
<p>Slivka executes each program in a new environment removing all
variables other than <code class="docutils literal notranslate"><span class="pre">PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">SLIVKA_HOME</span></code> and setting new
variables from <em>env</em>. If you want any system variable to be passed
to the new process, you need to re-define it here.</p>
<p>Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">env</span><span class="p">:</span>
  <span class="nt">PATH</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${HOME}/bin:${PATH}</span>  <span class="c1"># extend the existing PATH</span>
  <span class="nt">PYTHON</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/bin/python3.8</span>  <span class="c1"># define new variable</span>
  <span class="nt">PYTHONPATH</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHONPATH}</span>  <span class="c1"># pass the existing variable</span>
</pre></div>
</div>
</section>
<section id="input-parameters">
<span id="parameters-specification"></span><h3>Input parameters<a class="headerlink" href="#input-parameters" title="Permalink to this headline">¶</a></h3>
<p>The input parameters defined under <em>parameters</em> property list all
the variables that the users will be able to adjust when submitting
their jobs. Those are closely linked to the command line arguments,
in fact, they are the bridge between the front-end users and the
command line arguments.</p>
<p>Input <em>parameters</em> is a mapping just like command <em>args</em> where
each key is the parameter id and value is an object describing the
parameter. The ids of the parameters should match those of the
command line arguments defined in the previous section. The values
passed to the parameters by the user will be validated and passed to their
corresponding arguments.Not every argument has to have corresponding
input parameter; in such case the value for the argument will always
be empty and the argument will be skipped unless a default (constant)
is set. However, every input parameter needs to have corresponding
command line argument.</p>
<p>As mentioned before, input parameters is a mapping under the <em>parameters</em>
property where each key is the parameter identifier and each value is
an object defining the parameter having the following attributes
(which are optional unless stated otherwise):</p>
<dl class="field-list simple">
<dt class="field-odd"><em>name</em></dt>
<dd class="field-odd"><p><em>(required)</em>
Name of the parameter. Should be concise and self-explanatory.</p>
</dd>
<dt class="field-even"><em>description</em></dt>
<dd class="field-even"><p>Longer description of the parameter containing details about
its function.</p>
</dd>
<dt class="field-odd"><em>type</em></dt>
<dd class="field-odd"><p><em>(required)</em>
Type of the parameter, determines validation functions used on
the value and additional constraints that may be imposed.
Built-in types include <code class="docutils literal notranslate"><span class="pre">integer</span></code>, <code class="docutils literal notranslate"><span class="pre">decimal</span></code>, <code class="docutils literal notranslate"><span class="pre">text</span></code>,
<code class="docutils literal notranslate"><span class="pre">flag</span></code>, <code class="docutils literal notranslate"><span class="pre">choice</span></code> and <code class="docutils literal notranslate"><span class="pre">file</span></code>; however, a path to the custom
implementation of the type can be used as well (defining custom types
will be covered in advanced usage tutorial).
Type name can be immediately followed by a pair of square brackets
to convert in into an array variant e.g. <code class="docutils literal notranslate"><span class="pre">text[]</span></code>.</p>
</dd>
<dt class="field-even"><em>default</em></dt>
<dd class="field-even"><p>Value that will be used when user leaves the parameter empty.
Default value must meet all the type constraints and must be
an array for array types.</p>
</dd>
<dt class="field-odd"><em>required</em></dt>
<dd class="field-odd"><p>Determines whether the value for this parameter is required.
Allowed values are <code class="docutils literal notranslate"><span class="pre">yes</span></code> and <code class="docutils literal notranslate"><span class="pre">no</span></code>.
All parameters are required by default but specifying default value
nullifies the requirement.</p>
</dd>
<dt class="field-even"><em>condition</em></dt>
<dd class="field-even"><p>Mathematical/logical expression involving other parameters
that allows to conditionally disable the parameter or restrict
allowed values. Usage, syntax and limitations will be covered in
the advanced usage tutorial.</p>
</dd>
</dl>
<p>Those properties are always present regardless of the parameter
type. However, individual types allow extra attributes and value constraints.
The additional constraints are identical for the array type and are
evaluated for each value individually.</p>
<section id="integer-type">
<h4>Integer type<a class="headerlink" href="#integer-type" title="Permalink to this headline">¶</a></h4>
<dl class="field-list simple">
<dt class="field-odd"><em>min</em></dt>
<dd class="field-odd"><p>Integer. Minimum allowed value (inclusive), unbound if not present.</p>
</dd>
<dt class="field-even"><em>max</em></dt>
<dd class="field-even"><p>Integer. Maximum allowed value (inclusive), unbound if not present.</p>
</dd>
</dl>
</section>
<section id="decimal-type">
<h4>Decimal type<a class="headerlink" href="#decimal-type" title="Permalink to this headline">¶</a></h4>
<dl class="field-list simple">
<dt class="field-odd"><em>min</em></dt>
<dd class="field-odd"><p>Float. Minimum value, unbound if not present.</p>
</dd>
<dt class="field-even"><em>min-exclusive</em></dt>
<dd class="field-even"><p>Boolean. Whether the minimum is exclusive (inclusive by default).</p>
</dd>
<dt class="field-odd"><em>max</em></dt>
<dd class="field-odd"><p>Float. Maximum value, unbound if not present.</p>
</dd>
<dt class="field-even"><em>max-exclusive</em></dt>
<dd class="field-even"><p>Boolean. Whether the maximum is exclusive (inclusive by default).</p>
</dd>
</dl>
</section>
<section id="text-type">
<h4>Text type<a class="headerlink" href="#text-type" title="Permalink to this headline">¶</a></h4>
<dl class="field-list simple">
<dt class="field-odd"><em>min-length</em></dt>
<dd class="field-odd"><p>Integer. Minimum length of the text.</p>
</dd>
<dt class="field-even"><em>max-length</em></dt>
<dd class="field-even"><p>Integer. Maximum length of the text.</p>
</dd>
</dl>
</section>
<section id="choice-type">
<h4>Choice type<a class="headerlink" href="#choice-type" title="Permalink to this headline">¶</a></h4>
<dl class="field-list simple">
<dt class="field-odd"><em>choices</em></dt>
<dd class="field-odd"><p>Mapping of string to string. Contains the available choices – keys
and the values they are mapped to. The mapping allows to hide the
actual command line arguments and display more meaningful names
for the choices.</p>
</dd>
</dl>
</section>
<section id="file-type">
<h4>File type<a class="headerlink" href="#file-type" title="Permalink to this headline">¶</a></h4>
<dl class="field-list simple">
<dt class="field-odd"><em>media-type</em></dt>
<dd class="field-odd"><p>String. Checks the file content to be of the specified type. Media type
format follows <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc2045">RFC 2045</a>. Currently supported types include
plain text, json, yaml and bioinformatic data types which require
biopython to be installed.</p>
</dd>
<dt class="field-even"><em>media-type-parameters</em></dt>
<dd class="field-even"><p>Array of strings. Additional hints following the base media type.
Those are not used for value validation and serve solely as hints
for the users and client applications.</p>
</dd>
<dt class="field-odd"><em>default</em></dt>
<dd class="field-odd"><p>Default value is not currently allowed for the file type and setting
it will result in an error.</p>
</dd>
</dl>
</section>
</section>
<section id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h3>
<p>Once the process completes and creates the output files, users
need to be able to retrieve them. For that, they need to be listed
under the <em>outputs</em> property of the file. This, again, is a mapping
where each key is an item identifier and values are objects that
define output files shown to the users. Each output file object
has following properties:</p>
<dl class="field-list">
<dt class="field-odd"><em>path</em></dt>
<dd class="field-odd"><p><em>(required)</em> String.
Path or a <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)">glob</a> pattern that will be used to match files
in the directory where the process was run. No files outside
the working directory will be matched.
Glob pattern can be particularly useful if the program produces
multiple files that can be grouped together.
Additionally, standard output and error streams are automatically
redirected to the <code class="docutils literal notranslate"><span class="pre">stdout</span></code> and <code class="docutils literal notranslate"><span class="pre">stderr</span></code> files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Patterns starting with a special characters must be quoted.</p>
</div>
</dd>
<dt class="field-even"><em>media-type</em></dt>
<dd class="field-even"><p><em>(optional)</em> String.
Media type of the output file using <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc2045">RFC 2045</a> format.
Serves informative purpose only.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">log</span><span class="p">:</span>
  <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stdout</span>
<span class="nt">output</span><span class="p">:</span>
  <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output.txt</span>
  <span class="nt">media-type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">text/plain</span>
<span class="nt">auxiliary</span><span class="p">:</span>
  <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aux_*.json</span>
  <span class="nt">media-type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">application/json</span>
</pre></div>
</div>
</section>
<section id="execution-management">
<span id="id1"></span><h3>Execution management<a class="headerlink" href="#execution-management" title="Permalink to this headline">¶</a></h3>
<p>So far, we instructed slivka how to construct the command line arguments
for the program and what input parameters the web service wrapper should
present to the users.
The remaining piece is execution of the command on the operating system.
This role is fulfilled by the Runners which are configured under
the <em>execution</em> property of the service file.</p>
<p>Runners in slivka are classes that implement methods for starting the
command on the system and watching the completion of the process.
They are links between the abstract job and
the actual process running on the system.
Currently, there are three runner types that realise process execution
in three distinct ways.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ShellRunner</span></code> the simplest of all three. Runs the command as
a subprocess in the current shell. Doesn’t require any prior setup
but is only suitable for a very small workloads since spawning many
computationally-heavy processes can easily clog the operating system.
We do no recommend using it in production.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SlivkaQueueRunner</span></code> is an improvement of the shell runner which delegates
process execution to a separate slivka queue. The queue is better
suited for handling multiple jobs and can limit the number of simultaneous
workers to preserve system resources. It requires running local-queue
process to work.</p>
<p>Parameters:</p>
<dl class="field-list simple">
<dt class="field-odd"><em>address</em></dt>
<dd class="field-odd"><p>The address of the queue server if different than the one listed in the
main configuration file.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GridEngineRunner</span></code> uses a third-party Altair Grid Engine
(formerly Univa Grid Engine) to run the jobs using <code class="docutils literal notranslate"><span class="pre">qsub</span></code> command.
It allows for much more sophisticated resource management capable
of serving thousands of jobs. It requires the Grid engine to be
available on your system, however.</p>
<p>Parameters:</p>
<dl class="field-list simple">
<dt class="field-odd"><em>qargs</em></dt>
<dd class="field-odd"><p>List of arguments that will be placed directly after <code class="docutils literal notranslate"><span class="pre">qsub</span></code> command.
The runner provides <code class="docutils literal notranslate"><span class="pre">-V</span> <span class="pre">-cwd</span> <span class="pre">-o</span> <span class="pre">stdout</span> <span class="pre">-e</span> <span class="pre">stderr</span></code> arguments implicitly
and those should not be overridden.
The arguments can be a string or an array of strings.</p>
</dd>
</dl>
</li>
</ul>
<p>The <em>execution</em> property can have two sub-properties under it:
<em>runners</em> and <em>selector</em>.</p>
<section id="runners">
<h4>Runners<a class="headerlink" href="#runners" title="Permalink to this headline">¶</a></h4>
<p>Similarly to other values in this configuration file, <em>runners</em> contains
a mapping of runner ids to runner objects. You can specify multiple
runners, however, if the selector is not set, the one named <code class="docutils literal notranslate"><span class="pre">default</span></code>
will be always used. Each runner object has following properties:</p>
<dl class="field-list simple">
<dt class="field-odd"><em>type</em></dt>
<dd class="field-odd"><p>Type of the runner which is either a class name of one of the
built-in runners or a path to the custom class implementing Runner
interface. Creating custom runners will be covered in advanced usage
guide. Available Built-in runners are: <code class="docutils literal notranslate"><span class="pre">ShellRunner</span></code>,``SlivkaQueueRunner``
and <code class="docutils literal notranslate"><span class="pre">GridEngineRunner</span></code>.</p>
</dd>
<dt class="field-even"><em>parameters</em></dt>
<dd class="field-even"><p>Extra parameters that will be passed to the runner’s constructor
as keyword arguments.</p>
</dd>
</dl>
</section>
<section id="selector">
<h4>Selector<a class="headerlink" href="#selector" title="Permalink to this headline">¶</a></h4>
<p>The main idea behind having multiple runners is that depending on
the size of the job, we can decide how much resources we want to allocate
to execute it.
Selector is a Python function which, given the input parameters,
can decide and return the identifier of the runner suitable for
this job. It can also decide the job to be rejected based on the
parameters.
You can choose your own selector by setting the value of <em>selector</em>
property to the path to the python function.
The default selector (if unset) always chooses the <em>“default”</em> runner.</p>
</section>
</section>
</section>
<section id="command-line-interface">
<h2>Command line interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h2>
<p>Slivka consists of three components: RESTful HTTP server, job
scheduler (dispatcher) and a simple worker queue running jobs
on the local machine.
The separation allows to run those parts independently of each other.
In situations when the scheduler is down, the server keeps collecting
the requests stashing them in the database, so when the scheduler is working
again it can catch up with the server and dispatch all pending requests.
Similarly, when the server is down, the currently submitted jobs
are unaffected and can still be processed.</p>
<p>Each component can be started using <code class="docutils literal notranslate"><span class="pre">slivka</span></code> executable created during
Slivka package installation.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before you start, make sure that you have access to the running mongodb
server which is required but is not part of slivka package.</p>
</div>
<section id="http-server">
<h3>HTTP Server<a class="headerlink" href="#http-server" title="Permalink to this headline">¶</a></h3>
<p>Slivka server can be started from the directory containing configuration file with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slivka</span> <span class="n">start</span> <span class="n">server</span> <span class="o">--</span><span class="nb">type</span> <span class="n">gunicorn</span>
</pre></div>
</div>
<p>This will start a gunicorn server, serving slivka endpoints
using default settings specified in the <em>settings.yaml</em> file.</p>
<p>A full command line specification is:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>slivka start <span class="o">[</span>--home SLIVKA_HOME<span class="o">]</span> server <span class="se">\</span>
  <span class="o">[</span>--type TYPE<span class="o">]</span> <span class="o">[</span>--daemon/--no-daemon<span class="o">]</span> <span class="o">[</span>--pid-file PIDFILE<span class="o">]</span> <span class="se">\</span>
  <span class="o">[</span>--workers WORKERS<span class="o">]</span> <span class="o">[</span>--http-socket SOCKET<span class="o">]</span>
</pre></div>
</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SLIVKA_HOME</span></code></p></td>
<td><p>Path to the configurations directory.
Alternatively a SLIVKA_HOME environment variable can be set.
If neither is set, the current working directory is used.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TYPE</span></code></p></td>
<td><p>The wsgi application used to run the server. Currently available
options are: gunicorn, uwsgi and devel. Using devel is discouraged
in production as it can only serve one client at the time and may
potentially leak sensitive data.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--daemon/--no-daemon</span></code></p></td>
<td><p>Whether the process should run as a daemon.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PIDFILE</span></code></p></td>
<td><p>Path to the file where process’ pid will be written to.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">WORKERS</span></code></p></td>
<td><p>Number of server processes spawned on startup. Not applicable to
the development server.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SOCKET</span></code></p></td>
<td><p>Specify the socket the server will accept connection from
overriding the value from the settings file.</p></td>
</tr>
</tbody>
</table>
<p>If you want to have more control or decided to use different wsgi
application to run the server, you can use <em>wsgi.py</em> script provided
in the project directory which contains a wsgi-compatible application
(see <a class="reference external" href="https://www.python.org/dev/peps/pep-3333/">PEP-3333</a>).
Here is an alternative way of starting slivka server using gunicorn
(for details how to run the wsgi application with other servers
refer to their respective documentations).</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>gunicorn -b <span class="m">0</span>.0.0.0:8000 -w <span class="m">4</span> -n slivka-http wsgi
</pre></div>
</div>
</section>
<section id="scheduler">
<h3>Scheduler<a class="headerlink" href="#scheduler" title="Permalink to this headline">¶</a></h3>
<p>Slivka scheduler can be started from the project directory using</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>slivka start scheduler
</pre></div>
</div>
<p>The full command line specification is:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>slivka start <span class="o">[</span>--home SLIVKA_HOME<span class="o">]</span> scheduler <span class="se">\</span>
  <span class="o">[</span>--daemon/--no-daemon<span class="o">]</span> <span class="o">[</span>--pid-file PIDFILE<span class="o">]</span>
</pre></div>
</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SLIVKA_HOME</span></code></p></td>
<td><p>Path to the configurations directory.
Alternatively a SLIVKA_HOME environment variable can be set.
If neither is set, the current working directory is used.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--daemon/--no-daemon</span></code></p></td>
<td><p>Whether the process should run as a daemon.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PIDFILE</span></code></p></td>
<td><p>Path to the file where process’ pid will be written to.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="local-queue">
<h3>Local Queue<a class="headerlink" href="#local-queue" title="Permalink to this headline">¶</a></h3>
<p>The local queue can be started with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slivka</span> <span class="n">start</span> <span class="n">local</span><span class="o">-</span><span class="n">queue</span>
</pre></div>
</div>
<p>The full command line specification:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>slivka start <span class="o">[</span>--home SLIVKA_HOME<span class="o">]</span> local-queue <span class="se">\</span>
  <span class="o">[</span>--address ADDR<span class="o">]</span> <span class="o">[</span>--workers WORKERS<span class="o">]</span> <span class="se">\</span>
  <span class="o">[</span>--daemon/--no-daemon<span class="o">]</span> <span class="o">[</span>--pid-file PIDFILE<span class="o">]</span>
</pre></div>
</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SLIVKA_HOME</span></code></p></td>
<td><p>Path to the configurations directory.
Alternatively a SLIVKA_HOME environment variable can be set.
If neither is set, the current working directory is used.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ADDR</span></code></p></td>
<td><p>Address the queue server will bind to. Overrides the value
from the configuration file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">WORKERS</span></code></p></td>
<td><p>Maximum number of workers that will handle jobs simultaneously.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--daemon/--no-daemon</span></code></p></td>
<td><p>Whether the process should run as a daemon.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PIDFILE</span></code></p></td>
<td><p>Path to the file where process’ pid will be written to.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="stopping-processes">
<h3>Stopping Processes<a class="headerlink" href="#stopping-processes" title="Permalink to this headline">¶</a></h3>
<p>To stop any of these processes, send the <code class="docutils literal notranslate"><span class="pre">SIGINT</span></code> (2) “interrupt” or
<code class="docutils literal notranslate"><span class="pre">SIGTERM</span></code> (15) “terminate” signal to the process or press <strong>Ctrl + C</strong>
to send <code class="docutils literal notranslate"><span class="pre">KeyboardInterrupt</span></code> to the current process. Avoid using
<code class="docutils literal notranslate"><span class="pre">SIGKILL</span></code> (9) as killing the process abruptly may cause data
corruption.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuration</a><ul>
<li><a class="reference internal" href="#project-structure">Project Structure</a></li>
<li><a class="reference internal" href="#configuration-file">Configuration file</a></li>
<li><a class="reference internal" href="#service-configuration">Service configuration</a><ul>
<li><a class="reference internal" href="#metadata">Metadata</a></li>
<li><a class="reference internal" href="#command">Command</a><ul>
<li><a class="reference internal" href="#base-command">Base Command</a></li>
<li><a class="reference internal" href="#arguments">Arguments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#environment-variables">Environment variables</a></li>
<li><a class="reference internal" href="#input-parameters">Input parameters</a><ul>
<li><a class="reference internal" href="#integer-type">Integer type</a></li>
<li><a class="reference internal" href="#decimal-type">Decimal type</a></li>
<li><a class="reference internal" href="#text-type">Text type</a></li>
<li><a class="reference internal" href="#choice-type">Choice type</a></li>
<li><a class="reference internal" href="#file-type">File type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#outputs">Outputs</a></li>
<li><a class="reference internal" href="#execution-management">Execution management</a><ul>
<li><a class="reference internal" href="#runners">Runners</a></li>
<li><a class="reference internal" href="#selector">Selector</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#command-line-interface">Command line interface</a><ul>
<li><a class="reference internal" href="#http-server">HTTP Server</a></li>
<li><a class="reference internal" href="#scheduler">Scheduler</a></li>
<li><a class="reference internal" href="#local-queue">Local Queue</a></li>
<li><a class="reference internal" href="#stopping-processes">Stopping Processes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="getting_started.html"
                        title="previous chapter">Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="advanced_usage.html"
                        title="next chapter">Advanced Usage</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/specification.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="advanced_usage.html" title="Advanced Usage"
             >next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting Started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">slivka 0.8.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Configuration</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Mateusz Maciej Warowny.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
    </div>
  </body>
</html>